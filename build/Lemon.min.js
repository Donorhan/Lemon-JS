!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("Lemon",[],t):"object"==typeof exports?exports.Lemon=t():e.Lemon=t()}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var a=n[r]={exports:{},id:r,loaded:!1};return e[r].call(a.exports,a,a.exports,t),a.loaded=!0,a.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";var r=n(1),a=n(2),i=n(13),o=n(14),u=n(18),s=n(19),c=n(20),l=n(23),f=n(26),h=n(31),p=n(32),v=n(24),m=n(37),d=n(38),E=n(29),y=n(33),T=n(52),g=(n(40),n(39)),_=n(53),b=n(54),A=n(56),R=n(50),M=n(34),O=n(47),S=n(48),P=n(17),F=n(25),w=n(22);t.BlendMode=r.BlendMode,t.Camera=a.Camera,t.Color=i.Color,t.DirectionalLight=o.DirectionalLight,t.DrawingMode=u.DrawingMode,t.FileLoader=s.FileLoader,t.Geometry=c.Geometry,t.Material=l.Material,t.Mesh=f.Mesh,t.Model=h.Model,t.ModelLoader=p.ModelLoader,t.Pass=v.Pass,t.PointLight=m.PointLight,t.PostEffect=d.PostEffect,t.Program=E.Program,t.ProgramLibrary=y.ProgramLibrary,t.RenderCanvas=T.RenderCanvas,t.RenderTexture=g.RenderTexture,t.Scene=_.Scene,t.Skybox=b.Skybox,t.SpotLight=A.SpotLight,t.Sprite=R.Sprite,t.Texture=M.Texture,t.TextureCube=O.TextureCube,t.TextureVideo=S.TextureVideo,t.Transformable=P.Transformable,t.Type=F.Type,t.VertexFormat=w.VertexFormat,t.VertexElement=w.VertexElement},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0});var a=t.BlendMode=function(){function e(t){n(this,e),this.alphaSourceFactor=e.Factor.One,this.alphaDestinationFactor=e.Factor.OneMinusSourceAlpha,this.alphaEquation=e.Equation.Add,this.colorSourceFactor=e.Factor.SourceAlpha,this.colorDestinationFactor=e.Factor.OneMinusSourceAlpha,this.colorEquation=e.Equation.Add,t&&this.setMode(t)}return r(e,[{key:"setMode",value:function(t){switch(t){case e.Mode.Alpha:this.colorSourceFactor=e.Factor.SourceAlpha,this.colorDestinationFactor=e.Factor.OneMinusSourceAlpha,this.colorEquation=e.Equation.Add,this.alphaSourceFactor=e.Factor.One,this.alphaDestinationFactor=e.Factor.OneMinusSourceAlpha,this.alphaEquation=e.Equation.Add;break;case e.Mode.Add:this.colorSourceFactor=e.Factor.SourceAlpha,this.colorDestinationFactor=e.Factor.One,this.colorEquation=e.Equation.Add,this.alphaSourceFactor=e.Factor.One,this.alphaDestinationFactor=e.Factor.One,this.alphaEquation=e.Equation.Add;break;case e.Mode.Multiply:this.colorSourceFactor=e.Factor.DestinationColor,this.colorDestinationFactor=e.Factor.One,this.colorEquation=e.Equation.Add,this.alphaSourceFactor=e.Factor.One,this.alphaDestinationFactor=e.Factor.OneMinusSourceAlpha,this.alphaEquation=e.Equation.Add;break;default:case e.Mode.None:this.colorSourceFactor=e.Factor.One,this.colorDestinationFactor=e.Factor.Zero,this.colorEquation=e.Equation.Add,this.alphaSourceFactor=e.Factor.One,this.alphaDestinationFactor=e.Factor.OneMinusSourceAlpha,this.alphaEquation=e.Equation.Add}}},{key:"isEqual",value:function(e){return this.alphaSourceFactor==e.alphaSourceFactor&&this.alphaDestinationFactor==e.alphaDestinationFactor&&this.alphaEquation==e.alphaEquation&&this.colorSourceFactor==e.colorSourceFactor&&this.colorDestinationFactor==e.colorDestinationFactor&&this.colorEquation==e.colorEquation}}]),e}();a.Mode={Alpha:0,Add:1,Multiply:2,None:3},a.Factor={DestinationAlpha:0,DestinationColor:1,One:2,OneMinusDestinationAlpha:3,OneMinusDestinationColor:4,OneMinusSourceAlpha:5,OneMinusSourceColor:6,SourceAlpha:7,SourceColor:8,Zero:9},a.Equation={Add:0,Subtract:1}},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(3),o=t.Camera=function(){function e(){var t=arguments.length<=0||void 0===arguments[0]?e.Type.Perspective:arguments[0];r(this,e),this.direction=i.vec3.create(),this.fov=45,this.limits=i.vec2.fromValues(.1,100),this.matrixProjection=i.mat4.create(),this.matrixView=i.mat4.create(),this.matrixViewNeedUpdate=!0,this.matrixViewProjection=i.mat4.create(),this.matrixViewProjectionNeedUpdate=!0,this.position=i.vec3.fromValues(0,0,3),this.ratio=16/9,this.rotation=i.quat.fromValues(0,0,0,1),this.type=t,this.viewport=i.vec4.create(),this.zoomScale=1,this.setType(this.type)}return a(e,[{key:"lookAt",value:function(e,t,n){i.vec3.set(this.direction,e,t,n),this.matrixViewNeedUpdate=!0}},{key:"move",value:function(e,t,n){i.vec3.set(this.position,e,t,n),this.matrixViewNeedUpdate=!0}},{key:"rotate",value:function(e,t){function n(e,t){return[e[3]*t[0]+e[0]*t[3]+e[2]*t[1]-e[1]*t[2],e[3]*t[1]+e[1]*t[3]+e[0]*t[2]-e[2]*t[0],e[3]*t[2]+e[2]*t[3]+e[1]*t[0]-e[0]*t[1],e[3]*t[3]+e[0]*t[0]+e[1]*t[1]-e[2]*t[2]]}var r=i.quat.fromValues(0,0,0,1),a=i.quat.fromValues(0,0,0,1);i.quat.setAxisAngle(r,[0,1,0],e),i.quat.setAxisAngle(a,[1,0,0],-t),i.quat.multiply(this.rotation,r,a);var o=n(this.rotation,[this.direction[0],this.direction[1],this.direction[2],0]),u=n(this.rotation,[this.position[0],this.position[1],this.position[2],0]);i.vec3.set(this.direction,o[0],o[1],o[2]),i.vec3.set(this.position,u[0],u[1],u[2]),this.matrixViewNeedUpdate=!0}},{key:"setFieldOfView",value:function(e){this.fov=e,this.setType(this.type)}},{key:"setRatio",value:function(e){this.ratio=e,this.setType(this.type)}},{key:"setType",value:function(t){this.type=t,t==e.Type.Perspective?i.mat4.perspective(this.matrixProjection,i.glMatrix.toRadian(this.fov*this.zoomScale),this.ratio,this.limits[0],this.limits[1]):i.mat4.ortho(this.matrixProjection,-1.5*this.ratio*this.zoomScale,1.5*this.ratio*this.zoomScale,-1.5*this.zoomScale,1.5*this.zoomScale,this.limits[0],this.limits[1]),this.matrixViewProjectionNeedUpdate=!0}},{key:"setViewDistances",value:function(e,t){i.vec2.set(this.limits,e,t),this.setType(this.type)}},{key:"setViewport",value:function(e,t,n,r){i.vec4.set(this.viewport,e,t,n,r),this.setRatio(n/r)}},{key:"zoom",value:function(e){this.zoomScale=1/e,this.setType(this.type)}},{key:"getPosition",value:function(){return[this.position[0],this.position[1],this.position[2]]}},{key:"getProjectionMatrix",value:function(){return this.matrixProjection}},{key:"getViewMatrix",value:function(){return this.matrixViewNeedUpdate&&(i.mat4.lookAt(this.matrixView,this.position,this.direction,i.vec3.fromValues(0,1,0)),this.matrixViewNeedUpdate=!1,this.matrixViewProjectionNeedUpdate=!0),this.matrixView}},{key:"getViewport",value:function(){return this.viewport}},{key:"getViewProjectionMatrix",value:function(){return(this.matrixViewProjectionNeedUpdate||this.matrixViewNeedUpdate)&&(i.mat4.multiply(this.matrixViewProjection,this.getProjectionMatrix(),this.getViewMatrix()),this.matrixViewProjectionNeedUpdate=!1),this.matrixViewProjection}}]),e}();o.Type={Perspective:0,Orthographic:1}},function(e,t,n){t.glMatrix=n(4),t.mat2=n(5),t.mat2d=n(6),t.mat3=n(7),t.mat4=n(8),t.quat=n(9),t.vec2=n(12),t.vec3=n(10),t.vec4=n(11)},function(e,t){var n={};n.EPSILON=1e-6,n.ARRAY_TYPE="undefined"!=typeof Float32Array?Float32Array:Array,n.RANDOM=Math.random,n.setMatrixArrayType=function(e){GLMAT_ARRAY_TYPE=e};var r=Math.PI/180;n.toRadian=function(e){return e*r},e.exports=n},function(e,t,n){var r=n(4),a={};a.create=function(){var e=new r.ARRAY_TYPE(4);return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},a.clone=function(e){var t=new r.ARRAY_TYPE(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},a.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},a.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},a.transpose=function(e,t){if(e===t){var n=t[1];e[1]=t[2],e[2]=n}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e},a.invert=function(e,t){var n=t[0],r=t[1],a=t[2],i=t[3],o=n*i-a*r;return o?(o=1/o,e[0]=i*o,e[1]=-r*o,e[2]=-a*o,e[3]=n*o,e):null},a.adjoint=function(e,t){var n=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=n,e},a.determinant=function(e){return e[0]*e[3]-e[2]*e[1]},a.multiply=function(e,t,n){var r=t[0],a=t[1],i=t[2],o=t[3],u=n[0],s=n[1],c=n[2],l=n[3];return e[0]=r*u+i*s,e[1]=a*u+o*s,e[2]=r*c+i*l,e[3]=a*c+o*l,e},a.mul=a.multiply,a.rotate=function(e,t,n){var r=t[0],a=t[1],i=t[2],o=t[3],u=Math.sin(n),s=Math.cos(n);return e[0]=r*s+i*u,e[1]=a*s+o*u,e[2]=r*-u+i*s,e[3]=a*-u+o*s,e},a.scale=function(e,t,n){var r=t[0],a=t[1],i=t[2],o=t[3],u=n[0],s=n[1];return e[0]=r*u,e[1]=a*u,e[2]=i*s,e[3]=o*s,e},a.fromRotation=function(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=n,e[2]=-n,e[3]=r,e},a.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e},a.str=function(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},a.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2))},a.LDU=function(e,t,n,r){return e[2]=r[2]/r[0],n[0]=r[0],n[1]=r[1],n[3]=r[3]-e[2]*n[1],[e,t,n]},e.exports=a},function(e,t,n){var r=n(4),a={};a.create=function(){var e=new r.ARRAY_TYPE(6);return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e},a.clone=function(e){var t=new r.ARRAY_TYPE(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},a.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},a.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e},a.invert=function(e,t){var n=t[0],r=t[1],a=t[2],i=t[3],o=t[4],u=t[5],s=n*i-r*a;return s?(s=1/s,e[0]=i*s,e[1]=-r*s,e[2]=-a*s,e[3]=n*s,e[4]=(a*u-i*o)*s,e[5]=(r*o-n*u)*s,e):null},a.determinant=function(e){return e[0]*e[3]-e[1]*e[2]},a.multiply=function(e,t,n){var r=t[0],a=t[1],i=t[2],o=t[3],u=t[4],s=t[5],c=n[0],l=n[1],f=n[2],h=n[3],p=n[4],v=n[5];return e[0]=r*c+i*l,e[1]=a*c+o*l,e[2]=r*f+i*h,e[3]=a*f+o*h,e[4]=r*p+i*v+u,e[5]=a*p+o*v+s,e},a.mul=a.multiply,a.rotate=function(e,t,n){var r=t[0],a=t[1],i=t[2],o=t[3],u=t[4],s=t[5],c=Math.sin(n),l=Math.cos(n);return e[0]=r*l+i*c,e[1]=a*l+o*c,e[2]=r*-c+i*l,e[3]=a*-c+o*l,e[4]=u,e[5]=s,e},a.scale=function(e,t,n){var r=t[0],a=t[1],i=t[2],o=t[3],u=t[4],s=t[5],c=n[0],l=n[1];return e[0]=r*c,e[1]=a*c,e[2]=i*l,e[3]=o*l,e[4]=u,e[5]=s,e},a.translate=function(e,t,n){var r=t[0],a=t[1],i=t[2],o=t[3],u=t[4],s=t[5],c=n[0],l=n[1];return e[0]=r,e[1]=a,e[2]=i,e[3]=o,e[4]=r*c+i*l+u,e[5]=a*c+o*l+s,e},a.fromRotation=function(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=n,e[2]=-n,e[3]=r,e[4]=0,e[5]=0,e},a.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e},a.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e},a.str=function(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"},a.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+1)},e.exports=a},function(e,t,n){var r=n(4),a={};a.create=function(){var e=new r.ARRAY_TYPE(9);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},a.fromMat4=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},a.clone=function(e){var t=new r.ARRAY_TYPE(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},a.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},a.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},a.transpose=function(e,t){if(e===t){var n=t[1],r=t[2],a=t[5];e[1]=t[3],e[2]=t[6],e[3]=n,e[5]=t[7],e[6]=r,e[7]=a}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e},a.invert=function(e,t){var n=t[0],r=t[1],a=t[2],i=t[3],o=t[4],u=t[5],s=t[6],c=t[7],l=t[8],f=l*o-u*c,h=-l*i+u*s,p=c*i-o*s,v=n*f+r*h+a*p;return v?(v=1/v,e[0]=f*v,e[1]=(-l*r+a*c)*v,e[2]=(u*r-a*o)*v,e[3]=h*v,e[4]=(l*n-a*s)*v,e[5]=(-u*n+a*i)*v,e[6]=p*v,e[7]=(-c*n+r*s)*v,e[8]=(o*n-r*i)*v,e):null},a.adjoint=function(e,t){var n=t[0],r=t[1],a=t[2],i=t[3],o=t[4],u=t[5],s=t[6],c=t[7],l=t[8];return e[0]=o*l-u*c,e[1]=a*c-r*l,e[2]=r*u-a*o,e[3]=u*s-i*l,e[4]=n*l-a*s,e[5]=a*i-n*u,e[6]=i*c-o*s,e[7]=r*s-n*c,e[8]=n*o-r*i,e},a.determinant=function(e){var t=e[0],n=e[1],r=e[2],a=e[3],i=e[4],o=e[5],u=e[6],s=e[7],c=e[8];return t*(c*i-o*s)+n*(-c*a+o*u)+r*(s*a-i*u)},a.multiply=function(e,t,n){var r=t[0],a=t[1],i=t[2],o=t[3],u=t[4],s=t[5],c=t[6],l=t[7],f=t[8],h=n[0],p=n[1],v=n[2],m=n[3],d=n[4],E=n[5],y=n[6],T=n[7],g=n[8];return e[0]=h*r+p*o+v*c,e[1]=h*a+p*u+v*l,e[2]=h*i+p*s+v*f,e[3]=m*r+d*o+E*c,e[4]=m*a+d*u+E*l,e[5]=m*i+d*s+E*f,e[6]=y*r+T*o+g*c,e[7]=y*a+T*u+g*l,e[8]=y*i+T*s+g*f,e},a.mul=a.multiply,a.translate=function(e,t,n){var r=t[0],a=t[1],i=t[2],o=t[3],u=t[4],s=t[5],c=t[6],l=t[7],f=t[8],h=n[0],p=n[1];return e[0]=r,e[1]=a,e[2]=i,e[3]=o,e[4]=u,e[5]=s,e[6]=h*r+p*o+c,e[7]=h*a+p*u+l,e[8]=h*i+p*s+f,e},a.rotate=function(e,t,n){var r=t[0],a=t[1],i=t[2],o=t[3],u=t[4],s=t[5],c=t[6],l=t[7],f=t[8],h=Math.sin(n),p=Math.cos(n);return e[0]=p*r+h*o,e[1]=p*a+h*u,e[2]=p*i+h*s,e[3]=p*o-h*r,e[4]=p*u-h*a,e[5]=p*s-h*i,e[6]=c,e[7]=l,e[8]=f,e},a.scale=function(e,t,n){var r=n[0],a=n[1];return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=a*t[3],e[4]=a*t[4],e[5]=a*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},a.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e},a.fromRotation=function(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=n,e[2]=0,e[3]=-n,e[4]=r,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},a.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},a.fromMat2d=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e},a.fromQuat=function(e,t){var n=t[0],r=t[1],a=t[2],i=t[3],o=n+n,u=r+r,s=a+a,c=n*o,l=r*o,f=r*u,h=a*o,p=a*u,v=a*s,m=i*o,d=i*u,E=i*s;return e[0]=1-f-v,e[3]=l-E,e[6]=h+d,e[1]=l+E,e[4]=1-c-v,e[7]=p-m,e[2]=h-d,e[5]=p+m,e[8]=1-c-f,e},a.normalFromMat4=function(e,t){var n=t[0],r=t[1],a=t[2],i=t[3],o=t[4],u=t[5],s=t[6],c=t[7],l=t[8],f=t[9],h=t[10],p=t[11],v=t[12],m=t[13],d=t[14],E=t[15],y=n*u-r*o,T=n*s-a*o,g=n*c-i*o,_=r*s-a*u,b=r*c-i*u,A=a*c-i*s,R=l*m-f*v,M=l*d-h*v,O=l*E-p*v,S=f*d-h*m,P=f*E-p*m,F=h*E-p*d,w=y*F-T*P+g*S+_*O-b*M+A*R;return w?(w=1/w,e[0]=(u*F-s*P+c*S)*w,e[1]=(s*O-o*F-c*M)*w,e[2]=(o*P-u*O+c*R)*w,e[3]=(a*P-r*F-i*S)*w,e[4]=(n*F-a*O+i*M)*w,e[5]=(r*O-n*P-i*R)*w,e[6]=(m*A-d*b+E*_)*w,e[7]=(d*g-v*A-E*T)*w,e[8]=(v*b-m*g+E*y)*w,e):null},a.str=function(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"},a.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+Math.pow(e[6],2)+Math.pow(e[7],2)+Math.pow(e[8],2))},e.exports=a},function(e,t,n){var r=n(4),a={};a.create=function(){var e=new r.ARRAY_TYPE(16);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},a.clone=function(e){var t=new r.ARRAY_TYPE(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},a.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},a.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},a.transpose=function(e,t){if(e===t){var n=t[1],r=t[2],a=t[3],i=t[6],o=t[7],u=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=n,e[6]=t[9],e[7]=t[13],e[8]=r,e[9]=i,e[11]=t[14],e[12]=a,e[13]=o,e[14]=u}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e},a.invert=function(e,t){var n=t[0],r=t[1],a=t[2],i=t[3],o=t[4],u=t[5],s=t[6],c=t[7],l=t[8],f=t[9],h=t[10],p=t[11],v=t[12],m=t[13],d=t[14],E=t[15],y=n*u-r*o,T=n*s-a*o,g=n*c-i*o,_=r*s-a*u,b=r*c-i*u,A=a*c-i*s,R=l*m-f*v,M=l*d-h*v,O=l*E-p*v,S=f*d-h*m,P=f*E-p*m,F=h*E-p*d,w=y*F-T*P+g*S+_*O-b*M+A*R;return w?(w=1/w,e[0]=(u*F-s*P+c*S)*w,e[1]=(a*P-r*F-i*S)*w,e[2]=(m*A-d*b+E*_)*w,e[3]=(h*b-f*A-p*_)*w,e[4]=(s*O-o*F-c*M)*w,e[5]=(n*F-a*O+i*M)*w,e[6]=(d*g-v*A-E*T)*w,e[7]=(l*A-h*g+p*T)*w,e[8]=(o*P-u*O+c*R)*w,e[9]=(r*O-n*P-i*R)*w,e[10]=(v*b-m*g+E*y)*w,e[11]=(f*g-l*b-p*y)*w,e[12]=(u*M-o*S-s*R)*w,e[13]=(n*S-r*M+a*R)*w,e[14]=(m*T-v*_-d*y)*w,e[15]=(l*_-f*T+h*y)*w,e):null},a.adjoint=function(e,t){var n=t[0],r=t[1],a=t[2],i=t[3],o=t[4],u=t[5],s=t[6],c=t[7],l=t[8],f=t[9],h=t[10],p=t[11],v=t[12],m=t[13],d=t[14],E=t[15];return e[0]=u*(h*E-p*d)-f*(s*E-c*d)+m*(s*p-c*h),e[1]=-(r*(h*E-p*d)-f*(a*E-i*d)+m*(a*p-i*h)),e[2]=r*(s*E-c*d)-u*(a*E-i*d)+m*(a*c-i*s),e[3]=-(r*(s*p-c*h)-u*(a*p-i*h)+f*(a*c-i*s)),e[4]=-(o*(h*E-p*d)-l*(s*E-c*d)+v*(s*p-c*h)),e[5]=n*(h*E-p*d)-l*(a*E-i*d)+v*(a*p-i*h),e[6]=-(n*(s*E-c*d)-o*(a*E-i*d)+v*(a*c-i*s)),e[7]=n*(s*p-c*h)-o*(a*p-i*h)+l*(a*c-i*s),e[8]=o*(f*E-p*m)-l*(u*E-c*m)+v*(u*p-c*f),e[9]=-(n*(f*E-p*m)-l*(r*E-i*m)+v*(r*p-i*f)),e[10]=n*(u*E-c*m)-o*(r*E-i*m)+v*(r*c-i*u),e[11]=-(n*(u*p-c*f)-o*(r*p-i*f)+l*(r*c-i*u)),e[12]=-(o*(f*d-h*m)-l*(u*d-s*m)+v*(u*h-s*f)),e[13]=n*(f*d-h*m)-l*(r*d-a*m)+v*(r*h-a*f),e[14]=-(n*(u*d-s*m)-o*(r*d-a*m)+v*(r*s-a*u)),e[15]=n*(u*h-s*f)-o*(r*h-a*f)+l*(r*s-a*u),e},a.determinant=function(e){var t=e[0],n=e[1],r=e[2],a=e[3],i=e[4],o=e[5],u=e[6],s=e[7],c=e[8],l=e[9],f=e[10],h=e[11],p=e[12],v=e[13],m=e[14],d=e[15],E=t*o-n*i,y=t*u-r*i,T=t*s-a*i,g=n*u-r*o,_=n*s-a*o,b=r*s-a*u,A=c*v-l*p,R=c*m-f*p,M=c*d-h*p,O=l*m-f*v,S=l*d-h*v,P=f*d-h*m;return E*P-y*S+T*O+g*M-_*R+b*A},a.multiply=function(e,t,n){var r=t[0],a=t[1],i=t[2],o=t[3],u=t[4],s=t[5],c=t[6],l=t[7],f=t[8],h=t[9],p=t[10],v=t[11],m=t[12],d=t[13],E=t[14],y=t[15],T=n[0],g=n[1],_=n[2],b=n[3];return e[0]=T*r+g*u+_*f+b*m,e[1]=T*a+g*s+_*h+b*d,e[2]=T*i+g*c+_*p+b*E,e[3]=T*o+g*l+_*v+b*y,T=n[4],g=n[5],_=n[6],b=n[7],e[4]=T*r+g*u+_*f+b*m,e[5]=T*a+g*s+_*h+b*d,e[6]=T*i+g*c+_*p+b*E,e[7]=T*o+g*l+_*v+b*y,T=n[8],g=n[9],_=n[10],b=n[11],e[8]=T*r+g*u+_*f+b*m,e[9]=T*a+g*s+_*h+b*d,e[10]=T*i+g*c+_*p+b*E,e[11]=T*o+g*l+_*v+b*y,T=n[12],g=n[13],_=n[14],b=n[15],e[12]=T*r+g*u+_*f+b*m,e[13]=T*a+g*s+_*h+b*d,e[14]=T*i+g*c+_*p+b*E,e[15]=T*o+g*l+_*v+b*y,e},a.mul=a.multiply,a.translate=function(e,t,n){var r,a,i,o,u,s,c,l,f,h,p,v,m=n[0],d=n[1],E=n[2];return t===e?(e[12]=t[0]*m+t[4]*d+t[8]*E+t[12],e[13]=t[1]*m+t[5]*d+t[9]*E+t[13],e[14]=t[2]*m+t[6]*d+t[10]*E+t[14],e[15]=t[3]*m+t[7]*d+t[11]*E+t[15]):(r=t[0],a=t[1],i=t[2],o=t[3],u=t[4],s=t[5],c=t[6],l=t[7],f=t[8],h=t[9],p=t[10],v=t[11],e[0]=r,e[1]=a,e[2]=i,e[3]=o,e[4]=u,e[5]=s,e[6]=c,e[7]=l,e[8]=f,e[9]=h,e[10]=p,e[11]=v,e[12]=r*m+u*d+f*E+t[12],e[13]=a*m+s*d+h*E+t[13],e[14]=i*m+c*d+p*E+t[14],e[15]=o*m+l*d+v*E+t[15]),e},a.scale=function(e,t,n){var r=n[0],a=n[1],i=n[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*a,e[5]=t[5]*a,e[6]=t[6]*a,e[7]=t[7]*a,e[8]=t[8]*i,e[9]=t[9]*i,e[10]=t[10]*i,e[11]=t[11]*i,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},a.rotate=function(e,t,n,a){var i,o,u,s,c,l,f,h,p,v,m,d,E,y,T,g,_,b,A,R,M,O,S,P,F=a[0],w=a[1],C=a[2],x=Math.sqrt(F*F+w*w+C*C);return Math.abs(x)<r.EPSILON?null:(x=1/x,F*=x,w*=x,C*=x,i=Math.sin(n),o=Math.cos(n),u=1-o,s=t[0],c=t[1],l=t[2],f=t[3],h=t[4],p=t[5],v=t[6],m=t[7],d=t[8],E=t[9],y=t[10],T=t[11],g=F*F*u+o,_=w*F*u+C*i,b=C*F*u-w*i,A=F*w*u-C*i,R=w*w*u+o,M=C*w*u+F*i,O=F*C*u+w*i,S=w*C*u-F*i,P=C*C*u+o,e[0]=s*g+h*_+d*b,e[1]=c*g+p*_+E*b,e[2]=l*g+v*_+y*b,e[3]=f*g+m*_+T*b,e[4]=s*A+h*R+d*M,e[5]=c*A+p*R+E*M,e[6]=l*A+v*R+y*M,e[7]=f*A+m*R+T*M,e[8]=s*O+h*S+d*P,e[9]=c*O+p*S+E*P,e[10]=l*O+v*S+y*P,e[11]=f*O+m*S+T*P,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)},a.rotateX=function(e,t,n){var r=Math.sin(n),a=Math.cos(n),i=t[4],o=t[5],u=t[6],s=t[7],c=t[8],l=t[9],f=t[10],h=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=i*a+c*r,e[5]=o*a+l*r,e[6]=u*a+f*r,e[7]=s*a+h*r,e[8]=c*a-i*r,e[9]=l*a-o*r,e[10]=f*a-u*r,e[11]=h*a-s*r,e},a.rotateY=function(e,t,n){var r=Math.sin(n),a=Math.cos(n),i=t[0],o=t[1],u=t[2],s=t[3],c=t[8],l=t[9],f=t[10],h=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=i*a-c*r,e[1]=o*a-l*r,e[2]=u*a-f*r,e[3]=s*a-h*r,e[8]=i*r+c*a,e[9]=o*r+l*a,e[10]=u*r+f*a,e[11]=s*r+h*a,e},a.rotateZ=function(e,t,n){var r=Math.sin(n),a=Math.cos(n),i=t[0],o=t[1],u=t[2],s=t[3],c=t[4],l=t[5],f=t[6],h=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=i*a+c*r,e[1]=o*a+l*r,e[2]=u*a+f*r,e[3]=s*a+h*r,e[4]=c*a-i*r,e[5]=l*a-o*r,e[6]=f*a-u*r,e[7]=h*a-s*r,e},a.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e},a.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},a.fromRotation=function(e,t,n){var a,i,o,u=n[0],s=n[1],c=n[2],l=Math.sqrt(u*u+s*s+c*c);return Math.abs(l)<r.EPSILON?null:(l=1/l,u*=l,s*=l,c*=l,a=Math.sin(t),i=Math.cos(t),o=1-i,e[0]=u*u*o+i,e[1]=s*u*o+c*a,e[2]=c*u*o-s*a,e[3]=0,e[4]=u*s*o-c*a,e[5]=s*s*o+i,e[6]=c*s*o+u*a,e[7]=0,e[8]=u*c*o+s*a,e[9]=s*c*o-u*a,e[10]=c*c*o+i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)},a.fromXRotation=function(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=r,e[6]=n,e[7]=0,e[8]=0,e[9]=-n,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},a.fromYRotation=function(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=0,e[2]=-n,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=n,e[9]=0,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},a.fromZRotation=function(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=n,e[2]=0,e[3]=0,e[4]=-n,e[5]=r,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},a.fromRotationTranslation=function(e,t,n){var r=t[0],a=t[1],i=t[2],o=t[3],u=r+r,s=a+a,c=i+i,l=r*u,f=r*s,h=r*c,p=a*s,v=a*c,m=i*c,d=o*u,E=o*s,y=o*c;return e[0]=1-(p+m),e[1]=f+y,e[2]=h-E,e[3]=0,e[4]=f-y,e[5]=1-(l+m),e[6]=v+d,e[7]=0,e[8]=h+E,e[9]=v-d,e[10]=1-(l+p),e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e},a.fromRotationTranslationScale=function(e,t,n,r){var a=t[0],i=t[1],o=t[2],u=t[3],s=a+a,c=i+i,l=o+o,f=a*s,h=a*c,p=a*l,v=i*c,m=i*l,d=o*l,E=u*s,y=u*c,T=u*l,g=r[0],_=r[1],b=r[2];return e[0]=(1-(v+d))*g,e[1]=(h+T)*g,e[2]=(p-y)*g,e[3]=0,e[4]=(h-T)*_,e[5]=(1-(f+d))*_,e[6]=(m+E)*_,e[7]=0,e[8]=(p+y)*b,e[9]=(m-E)*b,e[10]=(1-(f+v))*b,e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e},a.fromRotationTranslationScaleOrigin=function(e,t,n,r,a){var i=t[0],o=t[1],u=t[2],s=t[3],c=i+i,l=o+o,f=u+u,h=i*c,p=i*l,v=i*f,m=o*l,d=o*f,E=u*f,y=s*c,T=s*l,g=s*f,_=r[0],b=r[1],A=r[2],R=a[0],M=a[1],O=a[2];return e[0]=(1-(m+E))*_,e[1]=(p+g)*_,e[2]=(v-T)*_,e[3]=0,e[4]=(p-g)*b,e[5]=(1-(h+E))*b,e[6]=(d+y)*b,e[7]=0,e[8]=(v+T)*A,e[9]=(d-y)*A,e[10]=(1-(h+m))*A,e[11]=0,e[12]=n[0]+R-(e[0]*R+e[4]*M+e[8]*O),e[13]=n[1]+M-(e[1]*R+e[5]*M+e[9]*O),e[14]=n[2]+O-(e[2]*R+e[6]*M+e[10]*O),e[15]=1,e},a.fromQuat=function(e,t){var n=t[0],r=t[1],a=t[2],i=t[3],o=n+n,u=r+r,s=a+a,c=n*o,l=r*o,f=r*u,h=a*o,p=a*u,v=a*s,m=i*o,d=i*u,E=i*s;return e[0]=1-f-v,e[1]=l+E,e[2]=h-d,e[3]=0,e[4]=l-E,e[5]=1-c-v,e[6]=p+m,e[7]=0,e[8]=h+d,e[9]=p-m,e[10]=1-c-f,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},a.frustum=function(e,t,n,r,a,i,o){var u=1/(n-t),s=1/(a-r),c=1/(i-o);return e[0]=2*i*u,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*i*s,e[6]=0,e[7]=0,e[8]=(n+t)*u,e[9]=(a+r)*s,e[10]=(o+i)*c,e[11]=-1,e[12]=0,e[13]=0,e[14]=o*i*2*c,e[15]=0,e},a.perspective=function(e,t,n,r,a){var i=1/Math.tan(t/2),o=1/(r-a);return e[0]=i/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=(a+r)*o,e[11]=-1,e[12]=0,e[13]=0,e[14]=2*a*r*o,e[15]=0,e},a.perspectiveFromFieldOfView=function(e,t,n,r){var a=Math.tan(t.upDegrees*Math.PI/180),i=Math.tan(t.downDegrees*Math.PI/180),o=Math.tan(t.leftDegrees*Math.PI/180),u=Math.tan(t.rightDegrees*Math.PI/180),s=2/(o+u),c=2/(a+i);return e[0]=s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=c,e[6]=0,e[7]=0,e[8]=-((o-u)*s*.5),e[9]=(a-i)*c*.5,e[10]=r/(n-r),e[11]=-1,e[12]=0,e[13]=0,e[14]=r*n/(n-r),e[15]=0,e},a.ortho=function(e,t,n,r,a,i,o){var u=1/(t-n),s=1/(r-a),c=1/(i-o);return e[0]=-2*u,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+n)*u,e[13]=(a+r)*s,e[14]=(o+i)*c,e[15]=1,e},a.lookAt=function(e,t,n,i){var o,u,s,c,l,f,h,p,v,m,d=t[0],E=t[1],y=t[2],T=i[0],g=i[1],_=i[2],b=n[0],A=n[1],R=n[2];return Math.abs(d-b)<r.EPSILON&&Math.abs(E-A)<r.EPSILON&&Math.abs(y-R)<r.EPSILON?a.identity(e):(h=d-b,p=E-A,v=y-R,m=1/Math.sqrt(h*h+p*p+v*v),h*=m,p*=m,v*=m,o=g*v-_*p,u=_*h-T*v,s=T*p-g*h,m=Math.sqrt(o*o+u*u+s*s),m?(m=1/m,o*=m,u*=m,s*=m):(o=0,u=0,s=0),c=p*s-v*u,l=v*o-h*s,f=h*u-p*o,m=Math.sqrt(c*c+l*l+f*f),m?(m=1/m,c*=m,l*=m,f*=m):(c=0,l=0,f=0),e[0]=o,e[1]=c,e[2]=h,e[3]=0,e[4]=u,e[5]=l,e[6]=p,e[7]=0,e[8]=s,e[9]=f,e[10]=v,e[11]=0,e[12]=-(o*d+u*E+s*y),e[13]=-(c*d+l*E+f*y),e[14]=-(h*d+p*E+v*y),e[15]=1,e)},a.str=function(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"},a.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+Math.pow(e[6],2)+Math.pow(e[7],2)+Math.pow(e[8],2)+Math.pow(e[9],2)+Math.pow(e[10],2)+Math.pow(e[11],2)+Math.pow(e[12],2)+Math.pow(e[13],2)+Math.pow(e[14],2)+Math.pow(e[15],2))},e.exports=a},function(e,t,n){var r=n(4),a=n(7),i=n(10),o=n(11),u={};u.create=function(){var e=new r.ARRAY_TYPE(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},u.rotationTo=function(){var e=i.create(),t=i.fromValues(1,0,0),n=i.fromValues(0,1,0);return function(r,a,o){var s=i.dot(a,o);return-.999999>s?(i.cross(e,t,a),i.length(e)<1e-6&&i.cross(e,n,a),i.normalize(e,e),u.setAxisAngle(r,e,Math.PI),r):s>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(i.cross(e,a,o),r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=1+s,u.normalize(r,r))}}(),u.setAxes=function(){var e=a.create();return function(t,n,r,a){return e[0]=r[0],e[3]=r[1],e[6]=r[2],e[1]=a[0],e[4]=a[1],e[7]=a[2],e[2]=-n[0],e[5]=-n[1],e[8]=-n[2],u.normalize(t,u.fromMat3(t,e))}}(),u.clone=o.clone,u.fromValues=o.fromValues,u.copy=o.copy,u.set=o.set,u.identity=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},u.setAxisAngle=function(e,t,n){n=.5*n;var r=Math.sin(n);return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=Math.cos(n),e},u.add=o.add,u.multiply=function(e,t,n){var r=t[0],a=t[1],i=t[2],o=t[3],u=n[0],s=n[1],c=n[2],l=n[3];return e[0]=r*l+o*u+a*c-i*s,e[1]=a*l+o*s+i*u-r*c,e[2]=i*l+o*c+r*s-a*u,e[3]=o*l-r*u-a*s-i*c,e},u.mul=u.multiply,u.scale=o.scale,u.rotateX=function(e,t,n){n*=.5;var r=t[0],a=t[1],i=t[2],o=t[3],u=Math.sin(n),s=Math.cos(n);return e[0]=r*s+o*u,e[1]=a*s+i*u,e[2]=i*s-a*u,e[3]=o*s-r*u,e},u.rotateY=function(e,t,n){n*=.5;var r=t[0],a=t[1],i=t[2],o=t[3],u=Math.sin(n),s=Math.cos(n);return e[0]=r*s-i*u,e[1]=a*s+o*u,e[2]=i*s+r*u,e[3]=o*s-a*u,e},u.rotateZ=function(e,t,n){n*=.5;var r=t[0],a=t[1],i=t[2],o=t[3],u=Math.sin(n),s=Math.cos(n);return e[0]=r*s+a*u,e[1]=a*s-r*u,e[2]=i*s+o*u,e[3]=o*s-i*u,e},u.calculateW=function(e,t){var n=t[0],r=t[1],a=t[2];return e[0]=n,e[1]=r,e[2]=a,e[3]=Math.sqrt(Math.abs(1-n*n-r*r-a*a)),e},u.dot=o.dot,u.lerp=o.lerp,u.slerp=function(e,t,n,r){var a,i,o,u,s,c=t[0],l=t[1],f=t[2],h=t[3],p=n[0],v=n[1],m=n[2],d=n[3];return i=c*p+l*v+f*m+h*d,0>i&&(i=-i,p=-p,v=-v,m=-m,d=-d),1-i>1e-6?(a=Math.acos(i),o=Math.sin(a),u=Math.sin((1-r)*a)/o,s=Math.sin(r*a)/o):(u=1-r,s=r),e[0]=u*c+s*p,e[1]=u*l+s*v,e[2]=u*f+s*m,e[3]=u*h+s*d,e},u.sqlerp=function(){var e=u.create(),t=u.create();return function(n,r,a,i,o,s){return u.slerp(e,r,o,s),u.slerp(t,a,i,s),u.slerp(n,e,t,2*s*(1-s)),n}}(),u.invert=function(e,t){var n=t[0],r=t[1],a=t[2],i=t[3],o=n*n+r*r+a*a+i*i,u=o?1/o:0;return e[0]=-n*u,e[1]=-r*u,e[2]=-a*u,e[3]=i*u,e},u.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},u.length=o.length,u.len=u.length,u.squaredLength=o.squaredLength,u.sqrLen=u.squaredLength,u.normalize=o.normalize,u.fromMat3=function(e,t){var n,r=t[0]+t[4]+t[8];if(r>0)n=Math.sqrt(r+1),e[3]=.5*n,n=.5/n,e[0]=(t[5]-t[7])*n,e[1]=(t[6]-t[2])*n,e[2]=(t[1]-t[3])*n;else{var a=0;t[4]>t[0]&&(a=1),t[8]>t[3*a+a]&&(a=2);var i=(a+1)%3,o=(a+2)%3;n=Math.sqrt(t[3*a+a]-t[3*i+i]-t[3*o+o]+1),e[a]=.5*n,n=.5/n,e[3]=(t[3*i+o]-t[3*o+i])*n,e[i]=(t[3*i+a]+t[3*a+i])*n,e[o]=(t[3*o+a]+t[3*a+o])*n}return e},u.str=function(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},e.exports=u},function(e,t,n){var r=n(4),a={};a.create=function(){var e=new r.ARRAY_TYPE(3);return e[0]=0,e[1]=0,e[2]=0,e},a.clone=function(e){var t=new r.ARRAY_TYPE(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},a.fromValues=function(e,t,n){var a=new r.ARRAY_TYPE(3);return a[0]=e,a[1]=t,a[2]=n,a},a.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},a.set=function(e,t,n,r){return e[0]=t,e[1]=n,e[2]=r,e},a.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e},a.subtract=function(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e},a.sub=a.subtract,a.multiply=function(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e},a.mul=a.multiply,a.divide=function(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e},a.div=a.divide,a.min=function(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e},a.max=function(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e},a.scale=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e},a.scaleAndAdd=function(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e},a.distance=function(e,t){var n=t[0]-e[0],r=t[1]-e[1],a=t[2]-e[2];return Math.sqrt(n*n+r*r+a*a)},a.dist=a.distance,a.squaredDistance=function(e,t){var n=t[0]-e[0],r=t[1]-e[1],a=t[2]-e[2];return n*n+r*r+a*a},a.sqrDist=a.squaredDistance,a.length=function(e){var t=e[0],n=e[1],r=e[2];return Math.sqrt(t*t+n*n+r*r)},a.len=a.length,a.squaredLength=function(e){var t=e[0],n=e[1],r=e[2];return t*t+n*n+r*r},a.sqrLen=a.squaredLength,a.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e},a.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e},a.normalize=function(e,t){var n=t[0],r=t[1],a=t[2],i=n*n+r*r+a*a;return i>0&&(i=1/Math.sqrt(i),e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i),e},a.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},a.cross=function(e,t,n){var r=t[0],a=t[1],i=t[2],o=n[0],u=n[1],s=n[2];return e[0]=a*s-i*u,e[1]=i*o-r*s,e[2]=r*u-a*o,e},a.lerp=function(e,t,n,r){var a=t[0],i=t[1],o=t[2];return e[0]=a+r*(n[0]-a),e[1]=i+r*(n[1]-i),e[2]=o+r*(n[2]-o),e},a.hermite=function(e,t,n,r,a,i){var o=i*i,u=o*(2*i-3)+1,s=o*(i-2)+i,c=o*(i-1),l=o*(3-2*i);return e[0]=t[0]*u+n[0]*s+r[0]*c+a[0]*l,e[1]=t[1]*u+n[1]*s+r[1]*c+a[1]*l,e[2]=t[2]*u+n[2]*s+r[2]*c+a[2]*l,e},a.bezier=function(e,t,n,r,a,i){var o=1-i,u=o*o,s=i*i,c=u*o,l=3*i*u,f=3*s*o,h=s*i;return e[0]=t[0]*c+n[0]*l+r[0]*f+a[0]*h,e[1]=t[1]*c+n[1]*l+r[1]*f+a[1]*h,e[2]=t[2]*c+n[2]*l+r[2]*f+a[2]*h,e},a.random=function(e,t){t=t||1;var n=2*r.RANDOM()*Math.PI,a=2*r.RANDOM()-1,i=Math.sqrt(1-a*a)*t;return e[0]=Math.cos(n)*i,e[1]=Math.sin(n)*i,e[2]=a*t,e},a.transformMat4=function(e,t,n){var r=t[0],a=t[1],i=t[2],o=n[3]*r+n[7]*a+n[11]*i+n[15];return o=o||1,e[0]=(n[0]*r+n[4]*a+n[8]*i+n[12])/o,e[1]=(n[1]*r+n[5]*a+n[9]*i+n[13])/o,e[2]=(n[2]*r+n[6]*a+n[10]*i+n[14])/o,
e},a.transformMat3=function(e,t,n){var r=t[0],a=t[1],i=t[2];return e[0]=r*n[0]+a*n[3]+i*n[6],e[1]=r*n[1]+a*n[4]+i*n[7],e[2]=r*n[2]+a*n[5]+i*n[8],e},a.transformQuat=function(e,t,n){var r=t[0],a=t[1],i=t[2],o=n[0],u=n[1],s=n[2],c=n[3],l=c*r+u*i-s*a,f=c*a+s*r-o*i,h=c*i+o*a-u*r,p=-o*r-u*a-s*i;return e[0]=l*c+p*-o+f*-s-h*-u,e[1]=f*c+p*-u+h*-o-l*-s,e[2]=h*c+p*-s+l*-u-f*-o,e},a.rotateX=function(e,t,n,r){var a=[],i=[];return a[0]=t[0]-n[0],a[1]=t[1]-n[1],a[2]=t[2]-n[2],i[0]=a[0],i[1]=a[1]*Math.cos(r)-a[2]*Math.sin(r),i[2]=a[1]*Math.sin(r)+a[2]*Math.cos(r),e[0]=i[0]+n[0],e[1]=i[1]+n[1],e[2]=i[2]+n[2],e},a.rotateY=function(e,t,n,r){var a=[],i=[];return a[0]=t[0]-n[0],a[1]=t[1]-n[1],a[2]=t[2]-n[2],i[0]=a[2]*Math.sin(r)+a[0]*Math.cos(r),i[1]=a[1],i[2]=a[2]*Math.cos(r)-a[0]*Math.sin(r),e[0]=i[0]+n[0],e[1]=i[1]+n[1],e[2]=i[2]+n[2],e},a.rotateZ=function(e,t,n,r){var a=[],i=[];return a[0]=t[0]-n[0],a[1]=t[1]-n[1],a[2]=t[2]-n[2],i[0]=a[0]*Math.cos(r)-a[1]*Math.sin(r),i[1]=a[0]*Math.sin(r)+a[1]*Math.cos(r),i[2]=a[2],e[0]=i[0]+n[0],e[1]=i[1]+n[1],e[2]=i[2]+n[2],e},a.forEach=function(){var e=a.create();return function(t,n,r,a,i,o){var u,s;for(n||(n=3),r||(r=0),s=a?Math.min(a*n+r,t.length):t.length,u=r;s>u;u+=n)e[0]=t[u],e[1]=t[u+1],e[2]=t[u+2],i(e,e,o),t[u]=e[0],t[u+1]=e[1],t[u+2]=e[2];return t}}(),a.angle=function(e,t){var n=a.fromValues(e[0],e[1],e[2]),r=a.fromValues(t[0],t[1],t[2]);a.normalize(n,n),a.normalize(r,r);var i=a.dot(n,r);return i>1?0:Math.acos(i)},a.str=function(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"},e.exports=a},function(e,t,n){var r=n(4),a={};a.create=function(){var e=new r.ARRAY_TYPE(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e},a.clone=function(e){var t=new r.ARRAY_TYPE(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},a.fromValues=function(e,t,n,a){var i=new r.ARRAY_TYPE(4);return i[0]=e,i[1]=t,i[2]=n,i[3]=a,i},a.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},a.set=function(e,t,n,r,a){return e[0]=t,e[1]=n,e[2]=r,e[3]=a,e},a.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e},a.subtract=function(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e},a.sub=a.subtract,a.multiply=function(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e[3]=t[3]*n[3],e},a.mul=a.multiply,a.divide=function(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e[3]=t[3]/n[3],e},a.div=a.divide,a.min=function(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e[3]=Math.min(t[3],n[3]),e},a.max=function(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e[3]=Math.max(t[3],n[3]),e},a.scale=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e},a.scaleAndAdd=function(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e},a.distance=function(e,t){var n=t[0]-e[0],r=t[1]-e[1],a=t[2]-e[2],i=t[3]-e[3];return Math.sqrt(n*n+r*r+a*a+i*i)},a.dist=a.distance,a.squaredDistance=function(e,t){var n=t[0]-e[0],r=t[1]-e[1],a=t[2]-e[2],i=t[3]-e[3];return n*n+r*r+a*a+i*i},a.sqrDist=a.squaredDistance,a.length=function(e){var t=e[0],n=e[1],r=e[2],a=e[3];return Math.sqrt(t*t+n*n+r*r+a*a)},a.len=a.length,a.squaredLength=function(e){var t=e[0],n=e[1],r=e[2],a=e[3];return t*t+n*n+r*r+a*a},a.sqrLen=a.squaredLength,a.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e},a.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e},a.normalize=function(e,t){var n=t[0],r=t[1],a=t[2],i=t[3],o=n*n+r*r+a*a+i*i;return o>0&&(o=1/Math.sqrt(o),e[0]=n*o,e[1]=r*o,e[2]=a*o,e[3]=i*o),e},a.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},a.lerp=function(e,t,n,r){var a=t[0],i=t[1],o=t[2],u=t[3];return e[0]=a+r*(n[0]-a),e[1]=i+r*(n[1]-i),e[2]=o+r*(n[2]-o),e[3]=u+r*(n[3]-u),e},a.random=function(e,t){return t=t||1,e[0]=r.RANDOM(),e[1]=r.RANDOM(),e[2]=r.RANDOM(),e[3]=r.RANDOM(),a.normalize(e,e),a.scale(e,e,t),e},a.transformMat4=function(e,t,n){var r=t[0],a=t[1],i=t[2],o=t[3];return e[0]=n[0]*r+n[4]*a+n[8]*i+n[12]*o,e[1]=n[1]*r+n[5]*a+n[9]*i+n[13]*o,e[2]=n[2]*r+n[6]*a+n[10]*i+n[14]*o,e[3]=n[3]*r+n[7]*a+n[11]*i+n[15]*o,e},a.transformQuat=function(e,t,n){var r=t[0],a=t[1],i=t[2],o=n[0],u=n[1],s=n[2],c=n[3],l=c*r+u*i-s*a,f=c*a+s*r-o*i,h=c*i+o*a-u*r,p=-o*r-u*a-s*i;return e[0]=l*c+p*-o+f*-s-h*-u,e[1]=f*c+p*-u+h*-o-l*-s,e[2]=h*c+p*-s+l*-u-f*-o,e[3]=t[3],e},a.forEach=function(){var e=a.create();return function(t,n,r,a,i,o){var u,s;for(n||(n=4),r||(r=0),s=a?Math.min(a*n+r,t.length):t.length,u=r;s>u;u+=n)e[0]=t[u],e[1]=t[u+1],e[2]=t[u+2],e[3]=t[u+3],i(e,e,o),t[u]=e[0],t[u+1]=e[1],t[u+2]=e[2],t[u+3]=e[3];return t}}(),a.str=function(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},e.exports=a},function(e,t,n){var r=n(4),a={};a.create=function(){var e=new r.ARRAY_TYPE(2);return e[0]=0,e[1]=0,e},a.clone=function(e){var t=new r.ARRAY_TYPE(2);return t[0]=e[0],t[1]=e[1],t},a.fromValues=function(e,t){var n=new r.ARRAY_TYPE(2);return n[0]=e,n[1]=t,n},a.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e},a.set=function(e,t,n){return e[0]=t,e[1]=n,e},a.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e},a.subtract=function(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e},a.sub=a.subtract,a.multiply=function(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e},a.mul=a.multiply,a.divide=function(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e},a.div=a.divide,a.min=function(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e},a.max=function(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e},a.scale=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e},a.scaleAndAdd=function(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e},a.distance=function(e,t){var n=t[0]-e[0],r=t[1]-e[1];return Math.sqrt(n*n+r*r)},a.dist=a.distance,a.squaredDistance=function(e,t){var n=t[0]-e[0],r=t[1]-e[1];return n*n+r*r},a.sqrDist=a.squaredDistance,a.length=function(e){var t=e[0],n=e[1];return Math.sqrt(t*t+n*n)},a.len=a.length,a.squaredLength=function(e){var t=e[0],n=e[1];return t*t+n*n},a.sqrLen=a.squaredLength,a.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e},a.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e},a.normalize=function(e,t){var n=t[0],r=t[1],a=n*n+r*r;return a>0&&(a=1/Math.sqrt(a),e[0]=t[0]*a,e[1]=t[1]*a),e},a.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]},a.cross=function(e,t,n){var r=t[0]*n[1]-t[1]*n[0];return e[0]=e[1]=0,e[2]=r,e},a.lerp=function(e,t,n,r){var a=t[0],i=t[1];return e[0]=a+r*(n[0]-a),e[1]=i+r*(n[1]-i),e},a.random=function(e,t){t=t||1;var n=2*r.RANDOM()*Math.PI;return e[0]=Math.cos(n)*t,e[1]=Math.sin(n)*t,e},a.transformMat2=function(e,t,n){var r=t[0],a=t[1];return e[0]=n[0]*r+n[2]*a,e[1]=n[1]*r+n[3]*a,e},a.transformMat2d=function(e,t,n){var r=t[0],a=t[1];return e[0]=n[0]*r+n[2]*a+n[4],e[1]=n[1]*r+n[3]*a+n[5],e},a.transformMat3=function(e,t,n){var r=t[0],a=t[1];return e[0]=n[0]*r+n[3]*a+n[6],e[1]=n[1]*r+n[4]*a+n[7],e},a.transformMat4=function(e,t,n){var r=t[0],a=t[1];return e[0]=n[0]*r+n[4]*a+n[12],e[1]=n[1]*r+n[5]*a+n[13],e},a.forEach=function(){var e=a.create();return function(t,n,r,a,i,o){var u,s;for(n||(n=2),r||(r=0),s=a?Math.min(a*n+r,t.length):t.length,u=r;s>u;u+=n)e[0]=t[u],e[1]=t[u+1],i(e,e,o),t[u]=e[0],t[u+1]=e[1];return t}}(),a.str=function(e){return"vec2("+e[0]+", "+e[1]+")"},e.exports=a},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0});t.Color=function(){function e(t,r,a){var i=arguments.length<=3||void 0===arguments[3]?1:arguments[3];n(this,e),this.r=t/255,this.g=r/255,this.b=a/255,this.a=i?i/255:1}return r(e,[{key:"set",value:function(e,t,n){var r=arguments.length<=3||void 0===arguments[3]?1:arguments[3];this.r=e/255,this.g=t/255,this.b=n/255,this.a=r?r/255:1}},{key:"isEqual",value:function(e){return this.r==e.r&&this.g==e.g&&this.b==e.b&&this.a==e.a}}]),e}()},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0}),t.DirectionalLight=void 0;var u=n(15);t.DirectionalLight=function(e){function t(){r(this,t);var e=a(this,Object.getPrototypeOf(t).call(this));return e.direction=[],e}return i(t,e),o(t,[{key:"setDirection",value:function(e,t,n){this.direction=[e,t,n]}},{key:"getDirection",value:function(){return this.direction}}]),t}(u.Light)},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0}),t.Light=void 0;var u=n(13),s=n(16);t.Light=function(e){function t(){r(this,t);var e=a(this,Object.getPrototypeOf(t).call(this));return e.ambient=new u.Color(255,255,255),e.diffuse=new u.Color(255,255,255),e.specular=new u.Color(255,255,255),e}return i(t,e),o(t,[{key:"visit",value:function(e){e.getRenderAPI().bindLight(this)}},{key:"setAmbientColor",value:function(e,t,n){this.ambient.set(e,t,n)}},{key:"setDiffuseColor",value:function(e,t,n){this.diffuse.set(e,t,n)}},{key:"setSpecularColor",value:function(e,t,n){this.specular.set(e,t,n)}},{key:"getAmbientColor",value:function(){return this.ambient}},{key:"getDiffuseColor",value:function(){return this.diffuse}},{key:"getSpecularColor",value:function(){return this.specular}}]),t}(s.Node)},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0}),t.Node=void 0;var u=n(17);t.Node=function(e){function t(){var e=arguments.length<=0||void 0===arguments[0]?"":arguments[0];r(this,t);var n=a(this,Object.getPrototypeOf(t).call(this));return n.children=[],n.name=e,n.parent=null,n}return i(t,e),o(t,[{key:"addChild",value:function(e){e!=this&&(e.parent&&e.parent.removeChild(e),this.children.push(e),e.parent=this)}},{key:"findChild",value:function(e){for(var t=0;t<this.children.length;t++){if(this.children[t].name==e)return this.children[t];var n=this.children[t].findChild(e);if(n)return n}return null}},{key:"removeChild",value:function(e){var t=this.children.indexOf(e);return-1!=t?(this.children.splice(t,1),e.parent=null,!0):!1}},{key:"setName",value:function(e){this.name=e}},{key:"update",value:function(e,t){var n=this.parent?this.parent.getTransformationMatrix():null;return this.computeTransformationMatrix(n,t)}},{key:"visit",value:function(e){}},{key:"getChildren",value:function(){return this.children}},{key:"isRoot",value:function(){return null===this.parent}}]),t}(u.Transformable)},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(3);t.Transformable=function(){function e(){r(this,e),this.matrix=i.mat4.create(),this.normalMatrix=i.mat4.create(),this.origin=i.vec3.create(),this.position=i.vec3.create(),this.rotation=i.quat.create(),this.rotationMatrix=i.mat4.create(),this.scale=i.vec3.fromValues(1,1,1),this.needTransformUpdate=!0}return a(e,[{key:"lookAt",value:function(){var e=arguments.length<=0||void 0===arguments[0]?[0,0,0]:arguments[0],t=arguments.length<=1||void 0===arguments[1]?[0,1,0]:arguments[1],n=i.vec3.create(),r=i.vec3.create(),a=i.vec3.create();i.vec3.subtract(a,e,this.position),i.vec3.normalize(a,a),i.vec3.subtract(a,e,this.position),i.vec3.normalize(a,a),i.vec3.cross(n,t,a),i.vec3.normalize(n,n),i.vec3.cross(r,a,n);var o=i.mat4.create();o[0]=n[0],o[1]=n[1],o[2]=n[2],o[3]=0,o[4]=r[0],o[5]=r[1],o[6]=r[2],o[7]=0,o[8]=a[0],o[9]=a[1],o[10]=a[2],o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,this.setRotationFromMatrix(o)}},{key:"setOrigin",value:function(e,t,n){i.vec3.set(this.origin,e,t,n),this.needTransformUpdate=!0}},{key:"setPosition",value:function(e,t,n){i.vec3.set(this.position,e,t,n),this.needTransformUpdate=!0}},{key:"setRotation",value:function(e,t,n){i.mat4.identity(this.rotationMatrix),i.mat4.rotateX(this.rotationMatrix,this.rotationMatrix,i.glMatrix.toRadian(e)),i.mat4.rotateY(this.rotationMatrix,this.rotationMatrix,i.glMatrix.toRadian(t)),i.mat4.rotateZ(this.rotationMatrix,this.rotationMatrix,i.glMatrix.toRadian(n));var r=i.mat3.create();i.mat3.fromMat4(r,this.rotationMatrix),i.quat.fromMat3(this.rotation,r),this.needTransformUpdate=!0}},{key:"setRotationFromQuaternion",value:function(e){i.mat4.fromQuat(this.rotationMatrix,e),this.rotation=e,this.needTransformUpdate=!0}},{key:"setRotationFromMatrix",value:function(e){i.quat.fromMat3(this.rotation,e),this.rotationMatrix=e,this.needTransformUpdate=!0}},{key:"setScale",value:function(e,t,n){i.vec3.set(this.scale,e,t,n),this.needTransformUpdate=!0}},{key:"computeTransformationMatrix",value:function(e,t){return t||this.needTransformUpdate?(i.mat4.identity(this.matrix),i.mat4.translate(this.matrix,this.matrix,this.position),i.mat4.multiply(this.matrix,this.matrix,this.rotationMatrix),i.mat4.scale(this.matrix,this.matrix,this.scale),e&&i.mat4.multiply(this.matrix,e,this.matrix),i.mat4.invert(this.normalMatrix,this.matrix),i.mat4.transpose(this.normalMatrix,this.normalMatrix),this.needTransformUpdate=!1,!0):!1}},{key:"getTransformationMatrix",value:function(){return this.matrix}},{key:"getNormalMatrix",value:function(){return this.normalMatrix}},{key:"getOrigin",value:function(){return this.origin}},{key:"getPosition",value:function(){return this.position}},{key:"getRotation",value:function(){throw"'getRotation' is not implemented for now â€¦"}},{key:"getScale",value:function(){return this.scale}}]),e}()},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0}),t.StencilOperation=t.StencilFunction=t.FaceCulling=t.DrawingMode=t.DepthFunction=t.StateBlock=void 0;var i=n(1),o=(t.StateBlock=function(){function e(){r(this,e),this.blendMode=new i.BlendMode,this.depthFunction=o.Less,this.depthWrite=!0,this.depthTest=!0,this.drawingMode=u.Triangles,this.faceCulling=s.Back,this.stencilFunction=c.Less,this.stencilReference=0,this.stencilMask=255,this.stencilTest=!1,this.stencilWrite=255,this.stencilTestFail=l.Keep,this.stencilDepthTestFail=l.Keep,this.stencilSuccess=l.Keep}return a(e,[{key:"isEqual",value:function(e){return this.blendMode.isEqual(e.blendMode)&&this.depthFunction==e.depthFunction&&this.depthWrite==e.depthWrite&&this.depthTest==e.depthTest&&this.stencilFunction==e.stencilFunction&&this.stencilReference==e.stencilReference&&this.stencilMask==e.stencilMask&&this.stencilTest==e.stencilTest&&this.stencilWrite==e.stencilWrite&&this.stencilTestFail==e.stencilTestFail&&this.stencilDepthTestFail==e.stencilDepthTestFail&&this.stencilSuccess==e.stencilSuccess}}]),e}(),t.DepthFunction=function f(){r(this,f)});o.Never=0,o.Less=1,o.Equal=2,o.LessEqual=3,o.Greater=4,o.NotEqual=5,o.GreaterEqual=6,o.Always=7;var u=t.DrawingMode=function h(){r(this,h)};u.Points=0,u.Lines=1,u.LinesStrip=2,u.LinesLoop=3,u.Triangles=4,u.TrianglesStrip=5,u.TrianglesFan=6;var s=t.FaceCulling=function p(){r(this,p)};s.Back=0,s.Front=1,s.None=2;var c=t.StencilFunction=function v(){r(this,v)};c.Never=0,c.Less=1,c.Equal=2,c.LessEqual=3,c.Greater=4,c.NotEqual=5,c.GreaterEqual=6,c.Always=7;var l=t.StencilOperation=function m(){r(this,m)};l.Keep=0,l.Zero=1,l.Replace=2,l.Increment=3,l.Decrement=4,l.Invert=5,l.IncrementWrap=6,l.DecrementWrap=7},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0});t.FileLoader=function(){function e(){n(this,e)}return r(e,null,[{key:"load",value:function(e,t,n){var r=new XMLHttpRequest;r.onreadystatechange=function(){4!==r.readyState||200!==r.status&&0!==r.status||t(!0,r.responseText,n)},r.open("GET",e,!0),r.send()}}]),e}()},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0}),t.Geometry=void 0;var u=n(21),s=n(22);t.Geometry=function(e){function t(){r(this,t);var e=a(this,Object.getPrototypeOf(t).call(this));return e.colors=null,e.indices=null,e.normals=null,e.positions=null,e.uvs=null,e.vertexFormat=null,e}return i(t,e),o(t,[{key:"setColors",value:function(e){this.colors=new Float32Array(e),this.vertexFormat&&this.vertexFormat.setStreamAsWaitingUpdate(s.VertexElement.Usage.Color,!0)}},{key:"setIndices",value:function(e){this.indices=new Uint16Array(e),this.vertexFormat&&this.vertexFormat.setIndicesAsWaitingUpdate(!0)}},{key:"setNormals",value:function(e){this.normals=new Float32Array(e),this.vertexFormat&&this.vertexFormat.setStreamAsWaitingUpdate(s.VertexElement.Usage.Normal,!0)}},{key:"setPositions",value:function(e){this.positions=new Float32Array(e),this.vertexFormat&&this.vertexFormat.setStreamAsWaitingUpdate(s.VertexElement.Usage.Position,!0)}},{key:"setTextureUVs",value:function(e){this.uvs=new Float32Array(e),this.vertexFormat&&this.vertexFormat.setStreamAsWaitingUpdate(s.VertexElement.Usage.UVS,!0)}},{key:"setVertexFormat",value:function(e){this.vertexFormat=e}},{key:"getVertexFormat",value:function(){return this.vertexFormat}},{key:"getIndexCount",value:function(){return this.indices.length}},{key:"getIndices",value:function(){return this.indices}},{key:"getVerticesColors",value:function(){return this.colors}},{key:"getVerticesPositions",value:function(){return this.positions}},{key:"getVerticesNormals",value:function(){return this.normals}},{key:"getVerticesUVs",value:function(){return this.uvs}}],[{key:"createCube",value:function(e,n,r){var a=new t,i=new s.VertexFormat;i.add(new s.VertexElement(s.VertexElement.Usage.Position,0,s.VertexElement.Type.Float,3,!1)),i.add(new s.VertexElement(s.VertexElement.Usage.Color,2,s.VertexElement.Type.Float,4,!1)),i.add(new s.VertexElement(s.VertexElement.Usage.UVS,1,s.VertexElement.Type.Float,2,!1)),i.add(new s.VertexElement(s.VertexElement.Usage.Normal,3,s.VertexElement.Type.Float,3,!1)),a.setVertexFormat(i);var o=new Float32Array([-e,-n,r,e,-n,r,e,n,r,-e,n,r,-e,-n,-r,-e,n,-r,e,n,-r,e,-n,-r,-e,n,-r,-e,n,r,e,n,r,e,n,-r,-e,-n,-r,e,-n,-r,e,-n,r,-e,-n,r,e,-n,-r,e,n,-r,e,n,r,e,-n,r,-e,-n,-r,-e,-n,r,-e,n,r,-e,n,-r]);a.setPositions(o);var u=new Float32Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]);a.setColors(u);var c=new Float32Array([0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1]);a.setTextureUVs(c);var l=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0]);a.setNormals(l);var f=new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]);return a.setIndices(f),a}},{key:"createRectangle",value:function(e,n){var r=new t,a=new s.VertexFormat;a.add(new s.VertexElement(s.VertexElement.Usage.Position,0,s.VertexElement.Type.Float,3,!1)),a.add(new s.VertexElement(s.VertexElement.Usage.Color,1,s.VertexElement.Type.Float,4,!1)),a.add(new s.VertexElement(s.VertexElement.Usage.UVS,2,s.VertexElement.Type.Float,2,!1)),a.add(new s.VertexElement(s.VertexElement.Usage.Normal,3,s.VertexElement.Type.Float,3,!1)),r.setVertexFormat(a);var i=new Float32Array([-e,-n,0,-e,n,0,e,-n,0,e,n,0]);r.setPositions(i);var o=new Float32Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]);r.setColors(o);var u=new Float32Array([0,1,0,0,1,1,1,0]);r.setTextureUVs(u);var c=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1]);return r.setNormals(c),r.setIndices(new Uint16Array([0,2,1,3])),r}}]),t}(u.ContextResource)},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0});var a=t.ContextResource=function(){function e(){n(this,e),this.UID=++e.globalID}return r(e,[{key:"getUID",value:function(){return this.UID}}]),e}();a.globalID=-1},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0});var a=t.VertexElement=function i(e,t,r){var a=arguments.length<=3||void 0===arguments[3]?0:arguments[3],o=arguments.length<=4||void 0===arguments[4]?!1:arguments[4];n(this,i),this.count=a,this.normalize=o,this.offset=0,this.stream=t,this.stride=0,this.type=r,this.usage=e};a.StreamType={Static:0,Dynamic:1,Stream:2},a.Type={Byte:0,Float:1,Int:2,Short:3},a.Usage={Position:0,Color:1,UVS:2,Normal:3,Tangent:4};t.VertexFormat=function(){function e(){n(this,e),this.elements=[],this.streamType=[],this.streamStride=[],this.streamNeedUpdate=[],this.indicesNeedUpdate=!0}return r(e,[{key:"add",value:function(e){this.elements.push(e),this.compute()}},{key:"set",value:function(e){this.elements=e,this.compute()}},{key:"setStreamType",value:function(e,t){this.streamType[e]=t}},{key:"compute",value:function(){var e=0,t=0,n=0;this.elements.sort(function(e,t){return e.stream<t.stream?-1:e.stream>t.stream?1:0});for(var r=0;r<this.elements.length;r++){switch(n!=this.elements[r].stream&&(this.streamStride[n]=e,e=0),this.elements[r].type){case a.Type.Float:case a.Type.Int:t=4;break;case a.Type.Short:t=2;break;case a.Type.Byte:t=1;break;default:t=1}this.elements[r].offset=e,t*=this.elements[r].count,e+=t,n=this.elements[r].stream}this.streamStride[n]=e}},{key:"setIndicesAsWaitingUpdate",value:function(e){this.indicesNeedUpdate=e}},{key:"setStreamAsWaitingUpdate",value:function(e,t){for(var n=0;n<this.elements.length;n++)this.elements[n].usage==e&&(this.streamNeedUpdate[this.elements[n].stream]=t)}},{key:"getElements",value:function(){return this.elements}},{key:"getStreamStride",value:function(e){return this.streamStride[e]||0}},{key:"getStreamType",value:function(e){return this.streamType[e]||a.StreamType.Stream}},{key:"isIndicesWaitingUpdate",value:function(){return this.indicesNeedUpdate}},{key:"isStreamWaitingUpdate",value:function(e){return this.streamNeedUpdate[e]}}]),e}()},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0}),t.Material=void 0;var i=n(24),o=n(25);t.Material=function(){function e(){r(this,e),this.activeTechnique=0,this.techniques=[],this.createTechnique()}return a(e,[{key:"createPass",value:function(){var e=arguments.length<=0||void 0===arguments[0]?0:arguments[0],t=new i.Pass;return this.techniques[e].push(t),t}},{key:"createTechnique",value:function(){return this.techniques.push([]),this.techniques.length-1}},{key:"setActiveTechnique",value:function(e){this.activeTechnique=e}},{key:"getActiveTechnique",value:function(){return this.activeTechnique}},{key:"getPass",value:function(e,t){return e>=this.techniques.length?null:this.techniques[e][t]||null}},{key:"getPassCount",value:function(){var e=arguments.length<=0||void 0===arguments[0]?0:arguments[0];return e>=this.techniques.length?0:this.techniques[e].length}}],[{key:"create",value:function(t){var n=new e,r=n.createPass();return"default"==t&&(r.add("material.ambient",o.Type.Float,[0,0,0]),r.add("material.diffuse",o.Type.Float,[.55,.55,.55]),r.add("material.specular",o.Type.Float,[.7,.7,.7]),r.add("material.shininess",o.Type.Float,38.4)),n}}]),e}()},function(e,t,n){"use strict";function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0}),t.Pass=t.PassParameter=void 0;var u=n(18),s=t.PassParameter=function c(e,t,n){i(this,c),this.name=e,this.type=t,this.value=n};t.Pass=function(e){function t(e,n,a){i(this,t);var o=r(this,Object.getPrototypeOf(t).call(this));return o.parameters=[],o}return a(t,e),o(t,[{key:"add",value:function(e,t,n){for(var r=0;r<this.parameters.length;r++)if(this.parameters[r].name==e)return this.parameters[r].value=n,void(this.parameters[r].type=t);this.parameters.push(new s(e,t,n))}},{key:"set",value:function(e,t){for(var n=0;n<this.parameters.length;n++)if(this.parameters[n].name==e){this.parameters[n].value=t;break}}},{key:"getParameters",value:function(){return this.parameters}}]),t}(u.StateBlock)},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=t.Type=function a(){n(this,a)};r.Float=0,r.Int=1,r.Bool=2,r.Matrix=3,r.Texture2D=4,r.TextureCube=5,r.Byte=6,r.u_Byte=7,r.Short=8,r.u_Short=9,r.u_Int=10},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0}),t.Mesh=void 0;var u=n(27),s=n(28);t.Mesh=function(e){function t(){r(this,t);var e=a(this,Object.getPrototypeOf(t).call(this));return e.geometry=null,e.material=null,e.program=null,e}return i(t,e),o(t,[{key:"draw",value:function(e){if(this.geometry&&this.material&&this.program)for(var t=e.getActiveTask(),n=this.material.getActiveTechnique(),r=this.material.getPassCount(n),a=0;r>a;a++)t.addCommand(new s.MeshCommand(this.geometry,this.material.getPass(n,a),this.program,this.getTransformationMatrix(),this.getNormalMatrix(),0,this.geometry.getIndexCount()))}},{key:"setGeometry",value:function(e){this.geometry=e}},{key:"setMaterial",value:function(e){this.material=e}},{key:"setProgram",value:function(e){this.program=e}},{key:"getProgram",value:function(){return this.program}}]),t}(u.Drawable)},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t;
}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0}),t.Drawable=void 0;var u=n(16);t.Drawable=function(e){function t(){return r(this,t),a(this,Object.getPrototypeOf(t).apply(this,arguments))}return i(t,e),o(t,[{key:"draw",value:function(e){}},{key:"visit",value:function(e){this.draw(e)}}]),t}(u.Node)},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0}),t.MeshCommand=void 0;var u=(n(29),n(30)),s=n(25);t.MeshCommand=function(e){function t(e,n,i,o,u,s,c){r(this,t);var l=a(this,Object.getPrototypeOf(t).call(this));return l.endVertex=c,l.geometry=e,l.modelMatrix=o,l.normalMatrix=u,l.pass=n,l.program=i,l.startVertex=s,l}return i(t,e),o(t,[{key:"execute",value:function(e){var t=e.setProgram(this.program);if(-1!=t){1==t&&e.setUniform(this.program,"uCamera",s.Type.Matrix,e.getActiveCamera().getViewProjectionMatrix()),e.setUniform(this.program,"uModel",s.Type.Matrix,this.modelMatrix),e.setUniform(this.program,"uModelNormal",s.Type.Matrix,this.normalMatrix),e.applyStateBlock(this.pass);for(var n=this.pass.getParameters(),r=0,a=0;a<n.length;a++){var i=n[a];switch(i.type){case s.Type.Texture2D:e.setUniform(this.program,i.name,s.Type.Int,r),e.bindTexture(r,i.value),r++;break;default:e.setUniform(this.program,i.name,i.type,i.value)}}e.setGeometry(this.geometry),e.drawIndexedPrimitives(this.pass.drawingMode,this.startVertex,this.endVertex)}}}]),t}(u.RenderCommand)},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0}),t.ProgramElement=t.Program=void 0;var u=n(21),s=n(19);t.Program=function(e){function t(){r(this,t);var e=a(this,Object.getPrototypeOf(t).call(this));return e.attributes=[],e.sources=[null,null],e.uniforms=[],e}return i(t,e),o(t,[{key:"loadFromFiles",value:function(e,t){var n=this;s.FileLoader.load(e,function(e,t){n.sources[0]=t}),s.FileLoader.load(t,function(e,t){n.sources[1]=t})}},{key:"loadFromData",value:function(e,t){this.sources[0]=e,this.sources[1]=t}},{key:"getAttributes",value:function(){return this.attributes}},{key:"getSources",value:function(){return this.sources}},{key:"getUniform",value:function(e){return this.uniforms[e]||null}},{key:"getUniforms",value:function(){return this.uniforms}},{key:"isReady",value:function(){return 2===this.sources.length&&null!==this.sources[0]&&null!==this.sources[1]}}]),t}(u.ContextResource),t.ProgramElement=function c(e,t,n,a){r(this,c),this.location=e,this.name=t,this.type=n,this.size=a}},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0});t.RenderCommand=function(){function e(){n(this,e)}return r(e,[{key:"isOpaque",value:function(){return!0}},{key:"execute",value:function(e){}}]),e}()},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=function l(e,t,n){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,t);if(void 0===r){var a=Object.getPrototypeOf(e);return null===a?void 0:l(a,t,n)}if("value"in r)return r.value;var i=r.get;if(void 0!==i)return i.call(n)};Object.defineProperty(t,"__esModule",{value:!0}),t.Model=void 0;var s=n(27),c=n(32);t.Model=function(e){function t(){var e=arguments.length<=0||void 0===arguments[0]?"":arguments[0];r(this,t);var n=a(this,Object.getPrototypeOf(t).call(this));return n.meshes=[],e.length&&n.loadFromFile(e),n}return i(t,e),o(t,[{key:"update",value:function(e,n){for(var r=u(Object.getPrototypeOf(t.prototype),"update",this).call(this,e,n),a=0;a<this.meshes.length;a++)this.meshes[a].computeTransformationMatrix(this.getTransformationMatrix(),r);return r}},{key:"draw",value:function(e){for(var t=0;t<this.meshes.length;t++)this.meshes[t].draw(e)}},{key:"loadFromFile",value:function(e){c.ModelLoader.loadFromFile(e,this)}}]),t}(s.Drawable)},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0}),t.ModelLoader=void 0;var i=n(18),o=n(19),u=n(20),s=n(23),c=n(26),l=n(33),f=n(34),h=n(25),p=n(22);t.ModelLoader=function(){function e(){r(this,e)}return a(e,null,[{key:"loadFromFile",value:function(t,n){o.FileLoader.load(t,function(t,n,r){var a=r.filePath.replace(/[^\/]*$/,"");e.parseJSON(n,r.model,a)},{model:n,filePath:t})}},{key:"parseJSON",value:function(e,t){var n=arguments.length<=2||void 0===arguments[2]?"":arguments[2],r=JSON.parse(e),a=[],o=void 0,v=void 0,m=void 0,d=void 0;for(o=0;o<r.materials.length;o++){var E=new s.Material,y=E.createPass();y.drawingMode=i.DrawingMode.Triangles;var T=r.materials[o].properties;for(v=0;v<T.length;v++){var g=T[v];if(1==g.type)"$mat.twosided"==g.key&&1==g.value?y.faceCulling=FaceCulling.None:"$mat.shininess"==g.key?y.add("material.shininess",h.Type.Float,g.value):"$clr.ambient"==g.key?y.add("material.ambient",h.Type.Float,[g.value[0],g.value[1],g.value[2]]):"$clr.diffuse"==g.key?y.add("material.diffuse",h.Type.Float,[g.value[0],g.value[1],g.value[2]]):"$clr.specular"==g.key?y.add("material.specular",h.Type.Float,[g.value[0],g.value[1],g.value[2]]):"$clr.emissive"==g.key&&y.add("material.emissive",h.Type.Float,[g.value[0],g.value[1],g.value[2]]);else if(3==g.type&&"?mat.name"!=g.key){var _=new f.Texture;_.loadFromFile(n+g.value);var b="material.diffuseTexture";switch(g.semantic){default:case 1:b="material.diffuseTexture";break;case 2:b="material.specularTexture";break;case 3:b="material.ambientTexture";break;case 4:b="material.emissiveTexture";break;case 5:b="material.heightTexture";break;case 6:b="material.normalsTexture";break;case 7:b="material.shininessTexture";break;case 8:b="material.opacityTexture";break;case 9:b="material.displacementTexture"}y.add(b,h.Type.Texture2D,_)}}a.push(E)}for(o=0;o<r.meshes.length;o++){var A=new c.Mesh;t.meshes.push(A);var R=r.meshes[o],M=new u.Geometry,O=new p.VertexFormat;M.setVertexFormat(O);var S=new Float32Array(R.vertices);O.add(new p.VertexElement(p.VertexElement.Usage.Position,0,p.VertexElement.Type.Float,3,!1)),M.setPositions(S);var P=new Float32Array(R.normals);if(O.add(new p.VertexElement(p.VertexElement.Usage.Normal,1,p.VertexElement.Type.Float,3,!1)),M.setNormals(P),R.texturecoords){var F=new Float32Array(R.texturecoords[0]);O.add(new p.VertexElement(p.VertexElement.Usage.UVS,2,p.VertexElement.Type.Float,R.numuvcomponents[0],!1)),M.setTextureUVs(F)}var w=new Uint16Array(3*R.faces.length);for(m=0,d=0;m<R.faces.length;m++,d+=3)w[d+0]=R.faces[m][0],w[d+1]=R.faces[m][1],w[d+2]=R.faces[m][2];if(M.setIndices(w),A.setGeometry(M),void 0!==R.materialindex&&a[R.materialindex])A.setMaterial(a[R.materialindex]);else{var E=new s.Material,y=E.createPass();y.drawingMode=i.DrawingMode.Triangles,y.add("material.ambient",h.Type.Float,[0,0,0]),y.add("material.diffuse",h.Type.Float,[.55,.55,.55]),y.add("material.specular",h.Type.Float,[.7,.7,.7]),y.add("material.shininess",h.Type.Float,38.4),A.setMaterial(E)}A.setProgram(l.ProgramLibrary.get("PhongShader"))}}}]),e}()},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0}),t.ProgramLibrary=void 0;var i=n(19),o=n(29),u=t.ProgramLibrary=function(){function e(){r(this,e)}return a(e,null,[{key:"get",value:function(t){var n=e.programs[t];return n||(n=new o.Program,e.programs[t]=n),n}},{key:"load",value:function(t,n,r,a){var o=e.get(t),u=/include\[([^\]]*)\]/g;e.cache[t]={data:null,ready:!1,sources:[]};var s=function(t,n,r){e.chunks[r].data=n,e.chunks[r].ready=!0,e.tryUpdateWaitingPrograms()},c=function(n,r,a){var o=e.programs[t],c=o.getSources(),l=a.match(u);if(l){for(var f=l.length,h=0;h<l.length;h++){var p=l[h],v=p.substring(p.lastIndexOf("[")+1,p.lastIndexOf("]"));e.chunks[v]&&e.chunks[v].ready?f--:e.chunks[v]||(e.chunks[v]={data:"",ready:!1},i.FileLoader.load(e.folderPath+v+"?"+(new Date).getTime(),s,v))}var m=e.replaceChunks(a);0===f&&e.fillProgram(c,o,t,n,m||"")}else e.fillProgram(c,o,t,n,a)};return i.FileLoader.load(e.folderPath+n+"?"+(new Date).getTime(),function(n,r){r=e.addDefines(r,a||[]),e.cache[t].sources[0]=r,c(e.Target.Vertex,t,r)}),i.FileLoader.load(e.folderPath+r+"?"+(new Date).getTime(),function(n,r){r=e.addDefines(r,a||[]),e.cache[t].sources[1]=r,c(e.Target.Fragment,t,r)}),o}},{key:"fillProgram",value:function(t,n,r,a,i){a==e.Target.Vertex?n.loadFromData(i,t[1]):n.loadFromData(t[0],i),n.isReady()&&delete e.cache[r]}},{key:"tryUpdateWaitingPrograms",value:function(){for(var t in e.programs)if(!e.programs[t].isReady())for(var n=e.programs[t].getSources(),r=0;2>r;r++)if(!n[r]){var a=e.replaceChunks(e.cache[t].sources[r]);a&&e.fillProgram(n,e.programs[t],t,0===r?e.Target.Vertex:e.Target.Fragment,a)}}},{key:"replaceChunks",value:function(t){for(var n=/include\[([^\]]*)\]/,r=t;n.test(r);){var a=r.match(n),i=a[0].substring(a[0].lastIndexOf("[")+1,a[0].lastIndexOf("]"));if(!e.chunks[i]||!e.chunks[i].ready)return null;r=r.replace(a[0],e.chunks[i].data||"")}return r}},{key:"addDefines",value:function(e,t){if(!t)return e;for(var n="",r=0;r<t.length;r++)n+="#define "+t[r]+"\n";return n+e}}]),e}();u.cache=[],u.chunks=[],u.folderPath="../shaders/",u.programs=[],u.Target={Vertex:0,Fragment:1}},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0}),t.Texture=void 0;var u=n(35),s=n(36);t.Texture=function(e){function t(){var e=arguments.length<=0||void 0===arguments[0]?"":arguments[0];r(this,t);var n=a(this,Object.getPrototypeOf(t).call(this));return n.image=null,n.repeat=!0,n.smooth=!0,e.length&&n.loadFromFile(e),n}return i(t,e),o(t,[{key:"loadFromFile",value:function(e){this.image=new s.Img,this.image.loadFromFile(e)}},{key:"loadFromImage",value:function(e){this.image=e}},{key:"setRepeated",value:function(e){this.repeat=e}},{key:"setSmooth",value:function(e){this.smooth=e}},{key:"getImage",value:function(){return this.image}},{key:"isReady",value:function(){if(!this.image)return!1;var e=this.image.getSize();return 0===e[0]||0===e[1]?!1:!0}},{key:"isRepeated",value:function(){return this.repeat}},{key:"isSmoothed",value:function(){return this.smooth}}]),t}(u.TextureInterface)},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0}),t.TextureInterface=void 0;var u=n(21);t.TextureInterface=function(e){function t(){r(this,t);var e=a(this,Object.getPrototypeOf(t).call(this));return e.ready=!1,e.mipmap=!0,e}return i(t,e),o(t,[{key:"isReady",value:function(){return this.ready}},{key:"isMipmaped",value:function(){return this.mipmap}},{key:"isRepeated",value:function(){return!1}},{key:"isSmoothed",value:function(){return!1}},{key:"useMipmap",value:function(e){this.mipmap=e}}]),t}(u.ContextResource)},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0});var a=t.Img=function(){function e(){n(this,e),this.data=new Image,this.height=0,this.pixels=null,this.status=e.Status.Unload,this.width=0}return r(e,[{key:"loadFromFile",value:function(t){var n=this;this.data.onload=function(){n.status=e.Status.Loaded,n.width=n.data.width,n.height=n.data.height,n.pixels=null},this.data.src=t}},{key:"create",value:function(t,n){var r=arguments.length<=2||void 0===arguments[2]?null:arguments[2];this.pixels=r?r:new Uint8Array(t*n*4),this.data=null,this.width=t,this.height=n,this.status=e.Status.Loaded}},{key:"getSize",value:function(){return[this.width,this.height]}},{key:"getData",value:function(){return this.data||this.pixels}},{key:"isReady",value:function(){return this.status==e.Status.Loaded}}]),e}();a.Status={Unload:0,Loading:1,Loaded:2}},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0}),t.PointLight=void 0;var u=n(15);t.PointLight=function(e){function t(){r(this,t);var e=a(this,Object.getPrototypeOf(t).call(this));return e.constant=1,e.linear=.09,e.quadratic=.032,e}return i(t,e),o(t,[{key:"setValues",value:function(e,t,n){this.constant=e,this.linear=t,this.quadratic=n}},{key:"getValues",value:function(){return[this.constant,this.linear,this.quadratic]}}]),t}(u.Light)},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0}),t.PostEffect=void 0;var i=n(13),o=n(39),u=n(50),s=n(51),c=n(43);t.PostEffect=function(){function e(t){r(this,e),this.renderApi=c.WebGL.getInstance(),this.renderTexture=null,this.sprite=new u.Sprite,this.sprite.setCustomProgram(t)}return a(e,[{key:"init",value:function(e,t){var n=arguments.length<=2||void 0===arguments[2]?!0:arguments[2],r=arguments.length<=3||void 0===arguments[3]?!1:arguments[3];this.renderTexture=new o.RenderTexture(e,t,1,n,r),this.sprite.setSize(1,1),this.sprite.setTexture(this.renderTexture.getTextures()[0]),this.sprite.setTextureRect(0,0,e,t)}},{key:"begin",value:function(){var e=arguments.length<=0||void 0===arguments[0]?new i.Color(30,30,30):arguments[0];this.renderTexture&&this.renderTexture.clear(e)}},{key:"end",value:function(){this.renderTexture&&(this.renderTexture.display(),s.SpriteCommand.draw(this.renderApi,this.sprite))}},{key:"render",value:function(e,t){this.renderTexture.render(e,t)}},{key:"setProgram",value:function(e){this.sprite.setCustomProgram(e)}},{key:"setEffectValue",value:function(e,t,n,r){this.renderApi.setUniform(this.sprite.getCustomProgram(),e,t,n,r)}}]),e}()},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=function h(e,t,n){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,t);if(void 0===r){var a=Object.getPrototypeOf(e);return null===a?void 0:h(a,t,n)}if("value"in r)return r.value;var i=r.get;if(void 0!==i)return i.call(n)};Object.defineProperty(t,"__esModule",{value:!0}),t.RenderTexture=void 0;var s=n(36),c=n(40),l=n(34),f=n(43);t.RenderTexture=function(e){function t(e,n,i){var o=arguments.length<=3||void 0===arguments[3]?!0:arguments[3],u=arguments.length<=4||void 0===arguments[4]?!1:arguments[4];r(this,t);var s=a(this,Object.getPrototypeOf(t).call(this));return s.renderApi=f.WebGL.getInstance(),s.framebuffer=s.renderApi.createFrameBuffer(),s.textures=[],s.init(e,n,i,o,u),s}return i(t,e),o(t,[{key:"init",value:function(e,t,n){for(var r=arguments.length<=3||void 0===arguments[3]?!0:arguments[3],a=arguments.length<=4||void 0===arguments[4]?!1:arguments[4],i=0;n>i;i++){var o=new s.Img;o.create(e,t,null);var u=new l.Texture;u.setRepeated(!1),u.setSmooth(!0),u.useMipmap(!1),u.loadFromImage(o),this.textures.push(u)}this.renderApi.initFrameBuffer(this.framebuffer,this.textures,r,a)}},{key:"clear",value:function(e){this.removeTasks(),this.begin(),this.renderApi.clear(e)}},{key:"begin",value:function(){this.renderApi.bindFrameBuffer(this.framebuffer)}},{key:"display",value:function(){u(Object.getPrototypeOf(t.prototype),"display",this).call(this),this.renderApi.bindFrameBuffer(-1)}},{key:"getTextures",value:function(){return this.textures}}]),t}(c.RenderTarget)},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0}),t.RenderTarget=void 0;var i=n(41),o=n(42);t.RenderTarget=function(){function e(){r(this,e),this.activeTask=null,this.context=new i.Context,this.tasks=[],this.renderApi=null}return a(e,[{key:"clear",value:function(e){}},{key:"display",value:function(){for(var e=0;e<this.tasks.length;e++)this.tasks[e].execute(this.renderApi)}},{key:"createTask",value:function(){return this.tasks.push(new o.RenderTask),this.tasks.length-1}},{key:"render",value:function(e,t){this.renderApi.clearCache(),this.renderApi.setActiveCamera(t),this.getActiveTask()||this.setActiveTask(this.createTask()),e.visit(this)}},{key:"setActiveTask",value:function(e){e>=0&&e<this.tasks.length&&(this.activeTask=this.tasks[e])}},{key:"getActiveTask",value:function(){return this.activeTask}},{key:"removeTasks",value:function(){this.tasks.length=0,this.activeTask=null}},{key:"getRenderAPI",value:function(){return this.renderApi}},{key:"getSize",value:function(){return this.context.getSize()}}]),e}()},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0});var a=t.Context=function(){function e(){n(this,e),this.domElement=null,this.instance=null}return r(e,[{key:"init",value:function(t,n,r){var a=document.getElementById(r);if(!a)throw"404 - Canvas with the name "+r+" not found.";t==e.Type.WebGL&&(this.domElement=document.createElement("canvas"),this.domElement.width=a.offsetWidth,this.domElement.height=a.offsetHeight,a.appendChild(this.domElement),this.instance=this.domElement.getContext("webgl",{antialias:n.antialiasing||!0}),this.instance.viewportWidth=this.domElement.width,this.instance.viewportHeight=this.domElement.height),e.current||(e.current=this)}},{key:"resize",value:function(e,t){this.domElement&&this.instance&&(this.domElement.width=e,this.domElement.height=t,this.instance.viewportWidth=e,this.instance.viewportHeight=t)}},{key:"activate",value:function(){e.current=this}},{key:"getSize",value:function(){return[this.domElement.width,this.domElement.height]}}],[{key:"getActive",value:function(){return e.current.instance}}]),e}();a.Type={WebGL:0},a.current=null},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0});t.RenderTask=function(){function e(){n(this,e),this.opaqueQueue=[],this.transparentQueue=[]}return r(e,[{key:"addCommand",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?0:arguments[1];e.isOpaque()?(this.opaqueQueue[t]=this.opaqueQueue[t]||[],this.opaqueQueue[t].push(e)):(this.transparentQueue[t]=this.transparentQueue[t]||[],this.transparentQueue[t].push(e))}},{key:"execute",value:function(e){var t=0,n=0;for(t=0;t<this.opaqueQueue.length;t++)for(n=0;n<this.opaqueQueue[t].length;n++)this.opaqueQueue[t][n].execute(e);for(t=0;t<this.transparentQueue.length;t++)for(n=0;n<this.transparentQueue[t].length;n++)this.transparentQueue[t][n].execute(e)}}]),e}()},function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=function R(e,t,n){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,t);if(void 0===r){var a=Object.getPrototypeOf(e);return null===a?void 0:R(a,t,n)}if("value"in r)return r.value;var i=r.get;if(void 0!==i)return i.call(n)};Object.defineProperty(t,"__esModule",{value:!0}),t.WebGL=void 0;var c=n(44),l=n(41),f=n(14),h=n(45),p=n(37),v=n(29),m=n(46),d=n(18),E=n(47),y=n(48),T=n(25),g=n(22),_=n(49),b=r(_),A=null;t.WebGL=function(e){function t(){var e;a(this,t);var n=i(this,Object.getPrototypeOf(t).call(this));return A||(A=n),n.cache=new c.Cache,n.enabledVertexAttribArray=[],n.instances=new h.Instances,n.state=new d.StateBlock,n.initStateBlockWithDefaultValues(n.state),e=A,i(n,e)}return o(t,e),u(t,[{key:"bindLight",value:function(e){this.cache.lights.push(e)}},{key:"bindFrameBuffer",value:function(e){var t=l.Context.getActive();if(-1==e)t.bindFramebuffer(b.FRAMEBUFFER,null);else{var n=this.instances.frameBuffers[e];if(!n)return;t.bindFramebuffer(b.FRAMEBUFFER,n)}}},{key:"bindTexture",value:function(e,t){if(t.isReady()){var n=t instanceof y.TextureVideo,r=!1,a=l.Context.getActive(),i=this.instances.textures[t.getUID()];if(i||(i=a.createTexture(),this.instances.textures[t.getUID()]=i,r=!0),this.cache.texture!=t&&(a.activeTexture(b.TEXTURE0+e),a.bindTexture(b.TEXTURE_2D,i)),r){var o=[0,0];if(a.pixelStorei(b.UNPACK_FLIP_Y_WEBGL,!0),n)a.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,t.getVideoData());else{var u=t.getImage(),s=u.getData();o=u.getSize(),s instanceof Image?a.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,s):a.texImage2D(b.TEXTURE_2D,0,b.RGBA,o[0],o[1],0,b.RGBA,b.UNSIGNED_BYTE,s)}var c=0===(o[0]&o[0]-1)&&0===(o[1]&o[1]-1);a.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,t.isRepeated()?b.REPEAT:b.CLAMP_TO_EDGE),a.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,t.isRepeated()?b.REPEAT:b.CLAMP_TO_EDGE),a.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,t.isSmoothed()?b.LINEAR:b.NEAREST);var f=c&&t.isMipmaped()?b.LINEAR_MIPMAP_NEAREST:b.LINEAR;a.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,t.isSmoothed()?f:b.NEAREST),!n&&c&&t.isMipmaped()&&a.generateMipmap(b.TEXTURE_2D)}else n&&a.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,t.getVideoData());this.cache.texture=t}}},{key:"bindTextureCube",value:function(e,t){if(t.isReady()){var n=l.Context.getActive(),r=!1,a=this.instances.textures[t.getUID()];if(a||(a=n.createTexture(),this.instances.textures[t.getUID()]=a,r=!0),this.cache.texture!=t&&(n.activeTexture(b.TEXTURE0+e),n.bindTexture(b.TEXTURE_CUBE_MAP,a)),r){var i=t.getImages();n.texImage2D(b.TEXTURE_CUBE_MAP_POSITIVE_X,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,i[E.TextureCube.Face.Left].getData()),n.texImage2D(b.TEXTURE_CUBE_MAP_NEGATIVE_X,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,i[E.TextureCube.Face.Right].getData()),n.texImage2D(b.TEXTURE_CUBE_MAP_POSITIVE_Y,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,i[E.TextureCube.Face.Up].getData()),n.texImage2D(b.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,i[E.TextureCube.Face.Down].getData()),n.texImage2D(b.TEXTURE_CUBE_MAP_POSITIVE_Z,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,i[E.TextureCube.Face.Front].getData()),n.texImage2D(b.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,i[E.TextureCube.Face.Back].getData()),n.texParameteri(b.TEXTURE_CUBE_MAP,b.TEXTURE_MAG_FILTER,b.NEAREST),n.texParameteri(b.TEXTURE_CUBE_MAP,b.TEXTURE_MIN_FILTER,b.NEAREST)}this.cache.texture=t}}},{key:"clear",value:function(e){e.isEqual(this.cache.clearColor)||(l.Context.getActive().clearColor(e.r,e.g,e.b,e.a),this.cache.clearColor=e),l.Context.getActive().clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT|b.DEPTH_BUFFER_BIT)}},{key:"clearCache",value:function(){this.cache.program=null,this.cache.lights.length=0}},{key:"createFrameBuffer",value:function(){var e=this.instances.frameBuffers.length,t=l.Context.getActive().createFramebuffer();return this.instances.frameBuffers.push(t),e}},{key:"drawIndexedPrimitives",value:function(e,t,n){l.Context.getActive().drawElements(this.convertDrawingModeToConstant(e),n,b.UNSIGNED_SHORT,t),this.disableVertexAttribArray()}},{key:"drawPrimitives",value:function(e,t,n){l.Context.getActive().drawArrays(this.convertDrawingModeToConstant(e),t,n),this.disableVertexAttribArray()}},{key:"disableVertexAttribArray",value:function(){var e=l.Context.getActive();for(var t in this.enabledVertexAttribArray)e.disableVertexAttribArray(t)}},{key:"initFrameBuffer",value:function(e,t){var n=arguments.length<=2||void 0===arguments[2]?!0:arguments[2],r=arguments.length<=3||void 0===arguments[3]?!1:arguments[3],a=this.instances.frameBuffers[e];if(a){var i=l.Context.getActive(),o=[0,0];this.bindFrameBuffer(e);
for(var u=0;u<t.length;u++){this.bindTexture(u,t[u]),o=t[u].getImage().getSize();var s=this.instances.textures[t[u].getUID()];i.framebufferTexture2D(b.FRAMEBUFFER,i.COLOR_ATTACHMENT0+u,b.TEXTURE_2D,s,0)}if(n||r){var c=i.createRenderbuffer();i.bindRenderbuffer(b.RENDERBUFFER,c),r?(i.renderbufferStorage(b.RENDERBUFFER,b.DEPTH_STENCIL,o[0],o[1]),i.framebufferRenderbuffer(b.FRAMEBUFFER,b.DEPTH_STENCIL_ATTACHMENT,b.RENDERBUFFER,c)):(i.renderbufferStorage(b.RENDERBUFFER,b.DEPTH_COMPONENT16,o[0],o[1]),i.framebufferRenderbuffer(b.FRAMEBUFFER,b.DEPTH_ATTACHMENT,b.RENDERBUFFER,c)),i.bindRenderbuffer(b.RENDERBUFFER,null)}this.bindFrameBuffer(-1)}}},{key:"initStateBlockWithDefaultValues",value:function(e){this.state.depthTest=!1,this.state.depthWrite=!1,this.state.stencilTest=!1}},{key:"sendLights",value:function(e){var t=this.instances.programs[e.getUID()];if(t){for(var n=this.cache.lights.length,r=this.cache.lights[0],a=!1,i=!1,o=0,u=0;o<this.cache.lights.length;o++,u+=3){r=this.cache.lights[o],r instanceof p.PointLight?this.cache.lightsType[o]=0:r instanceof f.DirectionalLight?this.cache.lightsType[o]=1:this.cache.lightsType[o]=2;var s=r.getAmbientColor();if(this.cache.lightsAmbient[u]=s.r,this.cache.lightsAmbient[u+1]=s.g,this.cache.lightsAmbient[u+2]=s.b,1!=this.cache.lightsType[o]){var c=r.getValues();this.cache.lightsData[u]=c[0],this.cache.lightsData[u+1]=c[1],this.cache.lightsData[u+2]=c[2],a=!0}else this.cache.lightsData[u]=0,this.cache.lightsData[u+1]=0,this.cache.lightsData[u+2]=0;var l=r.getDiffuseColor();if(this.cache.lightsDiffuse[u]=l.r,this.cache.lightsDiffuse[u+1]=l.g,this.cache.lightsDiffuse[u+2]=l.b,0!==this.cache.lightsType[o]){var h=r.getDirection();this.cache.lightsDirection[u]=h[0],this.cache.lightsDirection[u+1]=h[1],this.cache.lightsDirection[u+2]=h[2],i=!0}else this.cache.lightsDirection[u]=0,this.cache.lightsDirection[u+1]=0,this.cache.lightsDirection[u+2]=0;var v=r.getPosition();this.cache.lightsPosition[u]=v[0],this.cache.lightsPosition[u+1]=v[1],this.cache.lightsPosition[u+2]=v[2];var m=r.getSpecularColor();this.cache.lightsSpecular[u]=m.r,this.cache.lightsSpecular[u+1]=m.g,this.cache.lightsSpecular[u+2]=m.b}this.cache.lights.length&&(this.setUniform(e,"uCameraPosition",T.Type.Float,this.activeCamera.getPosition()),this.setUniform(e,"lights.count",T.Type.Int,n),this.setUniform(e,"lights.ambient",T.Type.Float,this.cache.lightsAmbient,3),a&&this.setUniform(e,"lights.data",T.Type.Float,this.cache.lightsData,3),this.setUniform(e,"lights.diffuse",T.Type.Float,this.cache.lightsDiffuse,3),i&&this.setUniform(e,"lights.direction",T.Type.Float,this.cache.lightsDirection,3),this.setUniform(e,"lights.position",T.Type.Float,this.cache.lightsPosition,3),this.setUniform(e,"lights.specular",T.Type.Float,this.cache.lightsSpecular,3),this.setUniform(e,"lights.type",T.Type.Int,this.cache.lightsType,1))}}},{key:"setActiveCamera",value:function(e){s(Object.getPrototypeOf(t.prototype),"setActiveCamera",this).call(this,e);var n=e.getViewport();l.Context.getActive().viewport(n[0],n[1],n[2],n[3])}},{key:"setBlendMode",value:function(e){if(!e.isEqual(this.state.blendMode)){var t=l.Context.getActive();e.colorSourceFactor==BlendMode.Factor.One&&e.colorDestinationFactor==BlendMode.Factor.Zero?t.disable(b.BLEND):(t.enable(b.BLEND),t.blendEquationSeparate(this.convertBlendingEquationToConstant(e.colorEquation),this.convertBlendingEquationToConstant(e.alphaEquation)),t.blendFuncSeparate(this.convertBlendingFactorToConstant(e.colorSourceFactor),this.convertBlendingFactorToConstant(e.colorDestinationFactor),this.convertBlendingFactorToConstant(e.alphaSourceFactor),this.convertBlendingFactorToConstant(e.alphaDestinationFactor))),this.state.blendMode=e}}},{key:"setDepthState",value:function(e,t,n){var r=l.Context.getActive();!e&&this.state.depthTest?r.disable(b.DEPTH_TEST):e&&(this.state.depthTest||r.enable(b.DEPTH_TEST),this.state.writeTest!=t&&(r.depthMask(t),this.state.writeTest=t),this.state.depthFunction!=n&&(r.depthFunc(this.convertDepthFunctionToConstant(n)),this.state.depthFunction=n)),this.state.depthTest=e}},{key:"setFaceCulling",value:function(e){if(this.state.faceCulling!=e){var t=l.Context.getActive();e==FaceCulling.None?t.disable(b.CULL_FACE):(this.state.faceCulling==FaceCulling.None&&t.enable(b.CULL_FACE),e==FaceCulling.Front?t.cullFace(b.FRONT):t.cullFace(b.BACK)),this.state.faceCulling=e}}},{key:"setIndexBuffer",value:function(e){l.Context.getActive().bindBuffer(b.ELEMENT_ARRAY_BUFFER,e)}},{key:"setGeometry",value:function(e){if(e.getVertexFormat()){this.setVertexFormat(e.getVertexFormat());var t=l.Context.getActive(),n=this.instances.buffers[e.getUID()];n||(n=new h.BufferData,this.instances.buffers[e.getUID()]=n),n.indexBuffer||(n.indexBuffer=t.createBuffer()),this.setIndexBuffer(n.indexBuffer),this.cache.vertexFormat.isIndicesWaitingUpdate()&&(t.bufferData(b.ELEMENT_ARRAY_BUFFER,e.getIndices(),b.STATIC_DRAW),this.cache.vertexFormat.setIndicesAsWaitingUpdate(!1));for(var r=this.cache.vertexFormat.getElements(),a=0;a<r.length;a++)if(n.vertexBuffers[a]||(n.vertexBuffers[a]=t.createBuffer()),this.setVertexBuffer(a,n.vertexBuffers[a]),this.cache.vertexFormat.isStreamWaitingUpdate(r[a].stream)){var i=this.convertStreamTypeToConstant(this.cache.vertexFormat.getStreamType(r[a].stream));switch(r[a].usage){case g.VertexElement.Usage.Position:t.bufferData(b.ARRAY_BUFFER,e.getVerticesPositions(),i);break;case g.VertexElement.Usage.Color:t.bufferData(b.ARRAY_BUFFER,e.getVerticesColors(),i);break;case g.VertexElement.Usage.UVS:t.bufferData(b.ARRAY_BUFFER,e.getVerticesUVs(),i);break;case g.VertexElement.Usage.Normal:t.bufferData(b.ARRAY_BUFFER,e.getVerticesNormals(),i);break;default:case g.VertexElement.Usage.Tangent:console.log("Given vertex element is not supported for now.")}this.cache.vertexFormat.setStreamAsWaitingUpdate(r[a].usage,!1)}}}},{key:"setProgram",value:function(e){var t=this.instances.programs[e.getUID()],n=l.Context.getActive();if(!t){if(!e.isReady())return-1;var r=e.getSources(),a=n.createProgram(),i=n.createShader(b.VERTEX_SHADER);n.shaderSource(i,r[0]),n.compileShader(i);var o=n.createShader(b.FRAGMENT_SHADER);n.shaderSource(o,r[1]),n.compileShader(o),n.attachShader(a,i),n.attachShader(a,o),n.bindAttribLocation(a,g.VertexElement.Usage.Position,"aPosition"),n.bindAttribLocation(a,g.VertexElement.Usage.UVS,"aTexCoord"),n.bindAttribLocation(a,g.VertexElement.Usage.Color,"aColor"),n.bindAttribLocation(a,g.VertexElement.Usage.Normal,"aNormal"),n.bindAttribLocation(a,g.VertexElement.Usage.Tangent,"aTangent"),n.linkProgram(a),n.deleteShader(i),n.deleteShader(o),this.instances.programs[e.getUID()]=a,t=a;var u=void 0,s=n.getProgramParameter(a,b.ACTIVE_UNIFORMS),c=e.getUniforms();for(u=0;s>u;u++){var f=n.getActiveUniform(a,u),h=f.name,p=f.name.indexOf("[",f.name.length-3);p>=0&&(h=f.name.substring(0,p)),c[h]=new v.ProgramElement(n.getUniformLocation(a,f.name),h,this.convertConstantToShaderTypes(f.type),f.size)}var m=n.getProgramParameter(a,b.ACTIVE_ATTRIBUTES),d=e.getAttributes();for(u=0;m>u;u++){var E=n.getActiveAttrib(a,u);d[E.name]=new v.ProgramElement(n.getAttribLocation(a,E.name),E.name,this.convertConstantToShaderTypes(E.type),E.size)}}return this.cache.program!=t?(n.useProgram(t),this.cache.program=t,this.sendLights(e),1):0}},{key:"setUniform",value:function(e,t,n,r){var a=arguments.length<=4||void 0===arguments[4]?0:arguments[4];this.setProgram(e);var i=e.getUniform(t);if(!i||!r)return!1;var o=l.Context.getActive();switch(n){case T.Type.Float:r instanceof Array?a&&a>=1?2==a?o.uniform2fv(i.location,r):3==a?o.uniform3fv(i.location,r):4==a?o.uniform4fv(i.location,r):1==a&&o.uniform1fv(i.location,r):3==r.length?o.uniform3f(i.location,r[0],r[1],r[2]):4==r.length?o.uniform4f(i.location,r[0],r[1],r[2],r[3]):3==r.length&&o.uniform2f(i.location,r[0],r[1]):o.uniform1f(i.location,r);break;case T.Type.Int:r instanceof Array?a&&a>=1?2==a?o.uniform2iv(i.location,r):3==a?o.uniform3iv(i.location,r):4==a?o.uniform4iv(i.location,r):1==a&&o.uniform1iv(i.location,r):3==r.length?o.uniform3i(i.location,r[0],r[1],r[2]):4==r.length?o.uniform4i(i.location,r[0],r[1],r[2],r[3]):2==r.length&&o.uniform2i(i.location,r[0],r[1]):o.uniform1i(i.location,r);break;case T.Type.Matrix:16==r.length?o.uniformMatrix4fv(i.location,!1,r):4==r.length?o.uniformMatrix2fv(i.location,!1,r):9==r.length&&o.uniformMatrix3fv(i.location,!1,r)}return!0}},{key:"setScissorTest",value:function(e,t,n,r,a){var i=l.Context.getActive();e?(i.enable(b.SCISSOR_TEST),i.scissor(t,n,r,a)):i.disable(b.SCISSOR_TEST)}},{key:"setStencilState",value:function(e,t){var n=l.Context.getActive();!e&&this.state.stencilTest?n.disable(b.STENCIL_TEST):e&&(this.state.stencilTest||n.enable(b.STENCIL_TEST),this.state.stencilWrite!=t&&(n.stencilMask(t),this.state.stencilWrite=t)),this.state.stencilTest=e}},{key:"setStencilFunction",value:function(e,t,n){(this.state.stencilFunction!=e||this.state.stencilReference!=t||this.state.stencilMask!=n)&&(l.Context.getActive().stencilFunc(this.convertStencilFunctionToConstant(e),t,n),this.state.stencilFunction=e,this.state.stencilReference=t,this.state.stencilMask=n)}},{key:"setStencilOperations",value:function(e,t,n){(this.state.stencilTestFail!=e||this.state.stencilDepthTestFail!=t||this.state.stencilSuccess!=n)&&(l.Context.getActive().stencilOp(this.convertStencilOperationToConstant(e),this.convertStencilOperationToConstant(t),this.convertStencilOperationToConstant(n)),this.state.stencilTestFail=e,this.state.stencilDepthTestFail=t,this.state.stencilSuccess=n)}},{key:"setVertexBuffer",value:function(e,t){var n=l.Context.getActive();n.bindBuffer(b.ARRAY_BUFFER,t);for(var r=this.cache.vertexFormat.getElements(),a=0;a<r.length;a++)r[a].stream==e&&(n.enableVertexAttribArray(r[a].usage),n.vertexAttribPointer(r[a].usage,r[a].count,this.convertVertexTypeToConstant(r[a].type),r[a].normalize,this.cache.vertexFormat.getStreamStride(r[a].stream),r[a].offset),this.enabledVertexAttribArray[r[a].usage]=!0)}},{key:"setVertexFormat",value:function(e){this.cache.vertexFormat=e}},{key:"convertBlendingFactorToConstant",value:function(e){switch(e){default:case BlendMode.Factor.Zero:return b.ZERO;case BlendMode.Factor.One:return b.ONE;case BlendMode.Factor.SourceColor:return b.SRC_COLOR;case BlendMode.Factor.OneMinusSourceColor:return b.ONE_MINUS_SRC_COLOR;case BlendMode.Factor.DestinationColor:return b.DST_COLOR;case BlendMode.Factor.OneMinusDestinationColor:return b.ONE_MINUS_DST_COLOR;case BlendMode.Factor.SourceAlpha:return b.SRC_ALPHA;case BlendMode.Factor.OneMinusSourceAlpha:return b.ONE_MINUS_SRC_ALPHA;case BlendMode.Factor.DestinationAlpha:return b.DST_ALPHA;case BlendMode.Factor.OneMinusDestinationAlpha:return b.ONE_MINUS_DST_ALPHA}}},{key:"convertBlendingEquationToConstant",value:function(e){switch(e){default:case BlendMode.Equation.Add:return b.FUNC_ADD;case BlendMode.Equation.Subtract:return b.FUNC_SUBTRACT}}},{key:"convertDepthFunctionToConstant",value:function(e){switch(e){case DepthFunction.Never:return b.NEVER;case DepthFunction.Less:return b.LESS;case DepthFunction.Equal:return b.EQUAL;case DepthFunction.LessEqual:return b.LEQUAL;case DepthFunction.Greater:return b.GREATER;case DepthFunction.NotEqual:return b.NOTEQUAL;case DepthFunction.GreaterEqual:return b.GEQUAL;case DepthFunction.Always:return b.ALWAYS;default:return b.LEQUAL}}},{key:"convertDrawingModeToConstant",value:function(e){switch(e){default:case d.DrawingMode.Points:return b.POINTS;case d.DrawingMode.Lines:return b.LINES;case d.DrawingMode.LinesStrip:return b.LINE_STRIP;case d.DrawingMode.LinesLoop:return b.LINE_LOOP;case d.DrawingMode.Triangles:return b.TRIANGLES;case d.DrawingMode.TrianglesStrip:return b.TRIANGLE_STRIP;case d.DrawingMode.TrianglesFan:return b.TRIANGLE_FAN}}},{key:"convertStencilFunctionToConstant",value:function(e){switch(e){case StencilFunction.Never:return b.NEVER;case StencilFunction.Less:return b.LESS;case StencilFunction.Equal:return b.EQUAL;case StencilFunction.LessEqual:return b.LEQUAL;case StencilFunction.Greater:return b.GREATER;case StencilFunction.NotEqual:return b.NOTEQUAL;case StencilFunction.GreaterEqual:return b.GEQUAL;case StencilFunction.Always:return b.ALWAYS;default:return b.LEQUAL}}},{key:"convertStencilOperationToConstant",value:function(e){switch(e){default:case StencilOperation.Keep:return b.KEEP;case StencilOperation.Zero:return b.ZERO;case StencilOperation.Replace:return b.REPLACE;case StencilOperation.Increment:return b.INCR;case StencilOperation.Decrement:return b.DECR;case StencilOperation.Invert:return b.INVERT;case StencilOperation.IncrementWrap:return b.INCR_WRAP;case StencilOperation.DecrementWrap:return b.DECR_WRAP}}},{key:"convertVertexTypeToConstant",value:function(e){switch(e){default:case g.VertexElement.Type.Byte:return b.BYTE;case g.VertexElement.Type.Float:return b.FLOAT;case g.VertexElement.Type.Int:return b.INT;case g.VertexElement.Type.Short:return b.SHORT}}},{key:"convertStreamTypeToConstant",value:function(e){switch(e){default:case g.VertexElement.StreamType.Static:return b.STATIC_DRAW;case g.VertexElement.StreamType.Dynamic:return b.DYNAMIC_DRAW;case g.VertexElement.StreamType.Stream:return b.STREAM_DRAW}}},{key:"convertConstantToShaderTypes",value:function(e){switch(e){default:case b.FLOAT:case b.FLOAT_VEC2:case b.FLOAT_VEC3:case b.FLOAT_VEC4:return T.Type.Float;case b.INT:case b.INT_VEC2:case b.INT_VEC3:case b.INT_VEC4:return T.Type.Int;case b.BOOL:case b.BOOL_VEC2:case b.BOOL_VEC3:case b.BOOL_VEC4:return T.Type.Bool;case b.FLOAT_MAT2:case b.FLOAT_MAT3:case b.FLOAT_MAT4:return T.Type.Matrix;case b.SAMPLER_2D:return T.Type.Texture2D;case b.SAMPLER_CUBE:return T.Type.TextureCube;case b.BYTE:return T.Type.Byte;case b.UNSIGNED_BYTE:return T.Type.u_Byte;case b.SHORT:return T.Type.Short;case b.UNSIGNED_SHORT:return T.Type.u_Short;case b.UNSIGNED_INT:return T.Type.u_Int}}},{key:"convertConstantToShaderCount",value:function(e){switch(e){default:case b.FLOAT:case b.INT:case b.BOOL:case b.SAMPLER_2D:case b.SAMPLER_CUBE:case b.BYTE:case b.UNSIGNED_BYTE:case b.SHORT:case b.UNSIGNED_SHORT:case b.UNSIGNED_INT:return 1;case b.FLOAT_VEC2:case b.INT_VEC2:case b.BOOL_VEC2:case b.FLOAT_MAT2:return 2;case b.FLOAT_VEC3:case b.INT_VEC3:case b.BOOL_VEC3:case b.FLOAT_MAT3:return 3;case b.FLOAT_VEC4:case b.INT_VEC4:case b.BOOL_VEC4:case b.FLOAT_MAT4:return 4}}}],[{key:"getInstance",value:function(){return A||(A=new t),A}}]),t}(m.RenderAPI)},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.Cache=void 0;var a=n(13);t.Cache=function i(){r(this,i),this.clearColor=new a.Color(1,1,1,255),this.program=null,this.texture=null,this.vertexFormat=null,this.lights=[],this.lightsAmbient=[],this.lightsDiffuse=[],this.lightsData=[],this.lightsDirection=[],this.lightsPosition=[],this.lightsSpecular=[],this.lightsType=[]}},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});t.BufferData=function r(){n(this,r),this.indexBuffer=null,this.vertexBuffers=[],this.vao=null},t.Instances=function a(){n(this,a),this.buffers=[],this.frameBuffers=[],this.programs=[],this.textures=[]}},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0});t.RenderAPI=function(){function e(){n(this,e),this.activeCamera=null}return r(e,[{key:"bindLight",value:function(e){}},{key:"applyStateBlock",value:function(e){this.setBlendMode(e.blendMode),this.setDepthState(e.depthTest,e.depthWrite,e.depthFunction),this.setFaceCulling(e.faceCulling),this.setStencilState(e.stencilTest,e.stencilWrite),this.setStencilFunction(e.stencilFunction,e.stencilReference,e.stencilMask),this.setStencilOperations(e.stencilTestFail,e.stencilDepthTestFail,e.stencilSuccess)}},{key:"bindFrameBuffer",value:function(){arguments.length<=0||void 0===arguments[0]?-1:arguments[0]}},{key:"bindTexture",value:function(e,t){}},{key:"bindTextureCube",value:function(e,t){}},{key:"clear",value:function(e){}},{key:"clearCache",value:function(){}},{key:"createFrameBuffer",value:function(){return 0}},{key:"drawIndexedPrimitives",value:function(e,t,n){}},{key:"drawPrimitives",value:function(e,t,n){}},{key:"initFrameBuffer",value:function(e,t){arguments.length<=2||void 0===arguments[2]?!0:arguments[2],arguments.length<=3||void 0===arguments[3]?!1:arguments[3]}},{key:"setActiveCamera",value:function(e){this.activeCamera=e}},{key:"setBlendMode",value:function(e){}},{key:"setDepthState",value:function(e,t,n){}},{key:"setFaceCulling",value:function(e){}},{key:"setGeometry",value:function(e){}},{key:"setIndexBuffer",value:function(e){}},{key:"setProgram",value:function(e){return-1}},{key:"setUniform",value:function(e,t,n,r,a){return!1}},{key:"setScissorTest",value:function(e,t,n,r,a){}},{key:"setStencilState",value:function(e,t){}},{key:"setStencilFunction",value:function(e,t,n){}},{key:"setStencilOperations",value:function(e,t,n){}},{key:"setVertexBuffer",value:function(e,t){}},{key:"setVertexFormat",value:function(e){}},{key:"getActiveCamera",value:function(){return this.activeCamera}}]),e}()},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0}),t.TextureCube=void 0;var u=n(21),s=n(36),c=t.TextureCube=function(e){function t(){var e=arguments.length<=0||void 0===arguments[0]?[]:arguments[0];r(this,t);var n=a(this,Object.getPrototypeOf(t).call(this));return n.images=[],e.length&&n.loadFromFiles(e),n}return i(t,e),o(t,[{key:"loadFromFiles",value:function(e){for(var t in e){var n=new s.Img;n.loadFromFile(e[t]),this.images[t]=n}}},{key:"getImages",value:function(){return this.images}},{key:"isReady",value:function(){if(0===this.images.length)return!1;for(var e=0;e<this.images.length;e++)if(!this.images[e].isReady())return!1;return!0}}]),t}(u.ContextResource);c.Face={Up:0,Down:1,Left:2,Right:3,Back:4,Front:5}},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0}),t.TextureVideo=void 0;var u=n(35);t.TextureVideo=function(e){function t(){r(this,t);var e=a(this,Object.getPrototypeOf(t).call(this));return e.data=document.createElement("video"),e}return i(t,e),o(t,[{key:"loadFromFile",value:function(e){var t=this;this.data.addEventListener("canplaythrough",function(){t.ready=!0},!0),this.data.preload="auto",this.data.src=e}},{key:"pause",value:function(){this.data.pause()}},{key:"play",value:function(){this.data.play()}},{key:"getDuration",value:function(){return this.data.duration}},{key:"getVideoData",value:function(){return this.data}}]),t}(u.TextureInterface)},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.DEPTH_BUFFER_BIT=256,t.STENCIL_BUFFER_BIT=1024,t.COLOR_BUFFER_BIT=16384,t.POINTS=0,t.LINES=1,t.LINE_LOOP=2,t.LINE_STRIP=3,t.TRIANGLES=4,t.TRIANGLE_STRIP=5,t.TRIANGLE_FAN=6,t.ZERO=0,t.ONE=1,t.SRC_COLOR=768,t.ONE_MINUS_SRC_COLOR=769,t.SRC_ALPHA=770,t.ONE_MINUS_SRC_ALPHA=771,t.DST_ALPHA=772,t.ONE_MINUS_DST_ALPHA=773,t.DST_COLOR=774,t.ONE_MINUS_DST_COLOR=775,t.SRC_ALPHA_SATURATE=776,t.FUNC_ADD=32774,t.BLEND_EQUATION=32777,t.BLEND_EQUATION_RGB=32777,t.BLEND_EQUATION_ALPHA=34877,t.FUNC_SUBTRACT=32778,t.FUNC_REVERSE_SUBTRACT=32779,t.BLEND_DST_RGB=32968,t.BLEND_SRC_RGB=32969,t.BLEND_DST_ALPHA=32970,t.BLEND_SRC_ALPHA=32971,t.CONSTANT_COLOR=32769,t.ONE_MINUS_CONSTANT_COLOR=32770,t.CONSTANT_ALPHA=32771,t.ONE_MINUS_CONSTANT_ALPHA=32772,t.BLEND_COLOR=32773,t.ARRAY_BUFFER=34962,t.ELEMENT_ARRAY_BUFFER=34963,t.ARRAY_BUFFER_BINDING=34964,t.ELEMENT_ARRAY_BUFFER_BINDING=34965,t.STREAM_DRAW=35040,t.STATIC_DRAW=35044,t.DYNAMIC_DRAW=35048,t.BUFFER_SIZE=34660,t.BUFFER_USAGE=34661,t.CURRENT_VERTEX_ATTRIB=34342,t.FRONT=1028,t.BACK=1029,t.FRONT_AND_BACK=1032,t.CULL_FACE=2884,t.BLEND=3042,t.DITHER=3024,t.STENCIL_TEST=2960,t.DEPTH_TEST=2929,t.SCISSOR_TEST=3089,t.POLYGON_OFFSET_FILL=32823,t.SAMPLE_ALPHA_TO_COVERAGE=32926,t.SAMPLE_COVERAGE=32928,t.NO_ERROR=0,t.INVALID_ENUM=1280,t.INVALID_VALUE=1281,t.INVALID_OPERATION=1282,t.OUT_OF_MEMORY=1285,t.CW=2304,t.CCW=2305,t.LINE_WIDTH=2849,t.ALIASED_POINT_SIZE_RANGE=33901,t.ALIASED_LINE_WIDTH_RANGE=33902,t.CULL_FACE_MODE=2885,t.FRONT_FACE=2886,t.DEPTH_RANGE=2928,t.DEPTH_WRITEMASK=2930,t.DEPTH_CLEAR_VALUE=2931,t.DEPTH_FUNC=2932,t.STENCIL_CLEAR_VALUE=2961,t.STENCIL_FUNC=2962,t.STENCIL_FAIL=2964,t.STENCIL_PASS_DEPTH_FAIL=2965,t.STENCIL_PASS_DEPTH_PASS=2966,t.STENCIL_REF=2967,t.STENCIL_VALUE_MASK=2963,t.STENCIL_WRITEMASK=2968,t.STENCIL_BACK_FUNC=34816,t.STENCIL_BACK_FAIL=34817,t.STENCIL_BACK_PASS_DEPTH_FAIL=34818,t.STENCIL_BACK_PASS_DEPTH_PASS=34819,t.STENCIL_BACK_REF=36003,t.STENCIL_BACK_VALUE_MASK=36004,t.STENCIL_BACK_WRITEMASK=36005,t.VIEWPORT=2978,t.SCISSOR_BOX=3088,t.COLOR_CLEAR_VALUE=3106,t.COLOR_WRITEMASK=3107,t.UNPACK_ALIGNMENT=3317,t.PACK_ALIGNMENT=3333,t.MAX_TEXTURE_SIZE=3379,t.MAX_VIEWPORT_DIMS=3386,t.SUBPIXEL_BITS=3408,t.RED_BITS=3410,t.GREEN_BITS=3411,t.BLUE_BITS=3412,t.ALPHA_BITS=3413,t.DEPTH_BITS=3414,t.STENCIL_BITS=3415,t.POLYGON_OFFSET_UNITS=10752,t.POLYGON_OFFSET_FACTOR=32824,t.TEXTURE_BINDING_2D=32873,t.SAMPLE_BUFFERS=32936,t.SAMPLES=32937,t.SAMPLE_COVERAGE_VALUE=32938,t.SAMPLE_COVERAGE_INVERT=32939,t.COMPRESSED_TEXTURE_FORMATS=34467,t.DONT_CARE=4352,t.FASTEST=4353,t.NICEST=4354,t.GENERATE_MIPMAP_HINT=33170,t.BYTE=5120,t.UNSIGNED_BYTE=5121,t.SHORT=5122,t.UNSIGNED_SHORT=5123,t.INT=5124,t.UNSIGNED_INT=5125,t.FLOAT=5126,t.DEPTH_COMPONENT=6402,t.ALPHA=6406,t.RGB=6407,t.RGBA=6408,t.LUMINANCE=6409,t.LUMINANCE_ALPHA=6410,t.UNSIGNED_SHORT_4_4_4_4=32819,t.UNSIGNED_SHORT_5_5_5_1=32820,t.UNSIGNED_SHORT_5_6_5=33635,t.FRAGMENT_SHADER=35632,t.VERTEX_SHADER=35633,t.MAX_VERTEX_ATTRIBS=34921,t.MAX_VERTEX_UNIFORM_VECTORS=36347,t.MAX_VARYING_VECTORS=36348,t.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661,t.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660,t.MAX_TEXTURE_IMAGE_UNITS=34930,t.MAX_FRAGMENT_UNIFORM_VECTORS=36349,t.SHADER_TYPE=35663,t.DELETE_STATUS=35712,t.LINK_STATUS=35714,t.VALIDATE_STATUS=35715,t.ATTACHED_SHADERS=35717,t.ACTIVE_UNIFORMS=35718,t.ACTIVE_ATTRIBUTES=35721,t.SHADING_LANGUAGE_VERSION=35724,t.CURRENT_PROGRAM=35725,t.NEVER=512,t.LESS=513,t.EQUAL=514,t.LEQUAL=515,t.GREATER=516,t.NOTEQUAL=517,t.GEQUAL=518,t.ALWAYS=519,t.KEEP=7680,t.REPLACE=7681,t.INCR=7682,t.DECR=7683,t.INVERT=5386,t.INCR_WRAP=34055,t.DECR_WRAP=34056,t.VENDOR=7936,t.RENDERER=7937,t.VERSION=7938,t.NEAREST=9728,t.LINEAR=9729,t.NEAREST_MIPMAP_NEAREST=9984,t.LINEAR_MIPMAP_NEAREST=9985,t.NEAREST_MIPMAP_LINEAR=9986,t.LINEAR_MIPMAP_LINEAR=9987,t.TEXTURE_MAG_FILTER=10240,t.TEXTURE_MIN_FILTER=10241,t.TEXTURE_WRAP_S=10242,t.TEXTURE_WRAP_T=10243,t.TEXTURE_2D=3553,t.TEXTURE=5890,t.TEXTURE_CUBE_MAP=34067,t.TEXTURE_BINDING_CUBE_MAP=34068,t.TEXTURE_CUBE_MAP_POSITIVE_X=34069,t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070,t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071,t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072,t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073,t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074,t.MAX_CUBE_MAP_TEXTURE_SIZE=34076,t.TEXTURE0=33984,t.TEXTURE1=33985,t.TEXTURE2=33986,t.TEXTURE3=33987,t.TEXTURE4=33988,t.TEXTURE5=33989,t.TEXTURE6=33990,t.TEXTURE7=33991,t.TEXTURE8=33992,t.TEXTURE9=33993,t.TEXTURE10=33994,t.TEXTURE11=33995,t.TEXTURE12=33996,t.TEXTURE13=33997,t.TEXTURE14=33998,t.TEXTURE15=33999,t.TEXTURE16=34e3,t.TEXTURE17=34001,t.TEXTURE18=34002,t.TEXTURE19=34003,t.TEXTURE20=34004,t.TEXTURE21=34005,t.TEXTURE22=34006,t.TEXTURE23=34007,t.TEXTURE24=34008,t.TEXTURE25=34009,t.TEXTURE26=34010,t.TEXTURE27=34011,t.TEXTURE28=34012,t.TEXTURE29=34013,t.TEXTURE30=34014,t.TEXTURE31=34015,t.ACTIVE_TEXTURE=34016,t.REPEAT=10497,t.CLAMP_TO_EDGE=33071,t.MIRRORED_REPEAT=33648,t.FLOAT_VEC2=35664,t.FLOAT_VEC3=35665,t.FLOAT_VEC4=35666,t.INT_VEC2=35667,t.INT_VEC3=35668,t.INT_VEC4=35669,t.BOOL=35670,t.BOOL_VEC2=35671,t.BOOL_VEC3=35672,t.BOOL_VEC4=35673,t.FLOAT_MAT2=35674,t.FLOAT_MAT3=35675,t.FLOAT_MAT4=35676,t.SAMPLER_2D=35678,t.SAMPLER_CUBE=35680,t.VERTEX_ATTRIB_ARRAY_ENABLED=34338,t.VERTEX_ATTRIB_ARRAY_SIZE=34339,t.VERTEX_ATTRIB_ARRAY_STRIDE=34340,t.VERTEX_ATTRIB_ARRAY_TYPE=34341,t.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922,t.VERTEX_ATTRIB_ARRAY_POINTER=34373,t.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975,t.COMPILE_STATUS=35713,t.LOW_FLOAT=36336,t.MEDIUM_FLOAT=36337,t.HIGH_FLOAT=36338,t.LOW_INT=36339,t.MEDIUM_INT=36340,t.HIGH_INT=36341,t.FRAMEBUFFER=36160,t.RENDERBUFFER=36161,t.RGBA4=32854,t.RGB5_A1=32855,t.RGB565=36194,t.DEPTH_COMPONENT16=33189,t.STENCIL_INDEX=6401,t.STENCIL_INDEX8=36168,t.DEPTH_STENCIL=34041,t.RENDERBUFFER_WIDTH=36162,t.RENDERBUFFER_HEIGHT=36163,t.RENDERBUFFER_INTERNAL_FORMAT=36164,t.RENDERBUFFER_RED_SIZE=36176,t.RENDERBUFFER_GREEN_SIZE=36177,t.RENDERBUFFER_BLUE_SIZE=36178,t.RENDERBUFFER_ALPHA_SIZE=36179,t.RENDERBUFFER_DEPTH_SIZE=36180,t.RENDERBUFFER_STENCIL_SIZE=36181,t.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048,t.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049,t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050,t.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051,t.COLOR_ATTACHMENT0=36064,t.DEPTH_ATTACHMENT=36096,t.STENCIL_ATTACHMENT=36128,t.DEPTH_STENCIL_ATTACHMENT=33306,t.NONE=0,t.FRAMEBUFFER_COMPLETE=36053,t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054,t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055,t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057,t.FRAMEBUFFER_UNSUPPORTED=36061,t.FRAMEBUFFER_BINDING=36006,t.RENDERBUFFER_BINDING=36007,t.MAX_RENDERBUFFER_SIZE=34024,t.INVALID_FRAMEBUFFER_OPERATION=1286,t.UNPACK_FLIP_Y_WEBGL=37440,t.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441,t.CONTEXT_LOST_WEBGL=37442,t.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443,t.BROWSER_DEFAULT_WEBGL=37444,t.HALF_FLOAT_OES=36193,t.FRAGMENT_SHADER_DERIVATIVE_HINT_OES=35723,t.VERTEX_ARRAY_BINDING_OES=34229,t.UNMASKED_VENDOR_WEBGL=37445,t.UNMASKED_RENDERER_WEBGL=37446,t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776,t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777,t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778,t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779,t.TEXTURE_MAX_ANISOTROPY_EXT=34046,t.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0}),t.Sprite=void 0;var u=n(1),s=n(13),c=n(27),l=n(51);t.Sprite=function(e){function t(){r(this,t);var e=a(this,Object.getPrototypeOf(t).call(this));return e.blendMode=new u.BlendMode(u.BlendMode.Mode.Alpha),e.color=new s.Color(255,255,255,255),e.rect=[0,0,0,0],e.size=[.5,.5],e.customProgram=null,e.texture=null,e}return i(t,e),o(t,[{key:"setBlendMode",value:function(e){this.blendMode=e}},{key:"setColor",value:function(e,t,n,r){this.color.set(e,t,n,r)}},{key:"draw",value:function(e){this.texture&&e.getActiveTask().addCommand(new l.SpriteCommand(this))}},{key:"setCustomProgram",value:function(e){this.customProgram=e}},{key:"setSize",value:function(e,t){this.size[0]=e,this.size[1]=t}},{key:"setTexture",value:function(e){this.texture=e}},{key:"setTextureRect",value:function(e,t,n,r){this.rect=[e,t,n,r]}},{key:"getBlendMode",value:function(){return this.blendMode}},{key:"getColor",value:function(){return this.color}},{key:"getCustomProgram",value:function(){return this.customProgram}},{key:"getSize",value:function(){return this.size}},{key:"getTexture",value:function(){return this.texture}},{key:"getTextureRect",value:function(){return this.rect}}]),t}(c.Drawable)},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0}),t.SpriteCommand=void 0;var u=n(18),s=n(20),c=n(29),l=n(30),f=n(48),h=n(25),p=t.SpriteCommand=function(e){function t(e){r(this,t);var n=a(this,Object.getPrototypeOf(t).call(this));return n.sprite=e,n}return i(t,e),o(t,[{key:"execute",value:function(e){t.draw(e,this.sprite)}}],[{key:"draw",value:function(e,n){var r=n.getTexture();if(r.isReady()){var a=n.getCustomProgram();if(!a){if(!t.isDefaultProgramLoaded())return;a=t.sharedProgram}var i=e.setProgram(a);if(-1!==i){var o=n.getTextureRect(),s=n.getSize();1===i&&e.setUniform(a,"uCamera",h.Type.Matrix,e.getActiveCamera().getViewProjectionMatrix()),e.setUniform(a,"uModel",h.Type.Matrix,n.getTransformationMatrix()),e.setBlendMode(n.getBlendMode()),e.setDepthState(!0,!0,u.DepthFunction.Less),e.bindTexture(0,r);var c=null;if(r instanceof f.TextureVideo)c=new Float32Array([0,1,0,0,1,1,1,0]);else{var l=r.getImage().getSize(),p=o[0]/l[0],v=(o[1]+o[3])/l[1],m=(o[0]+o[2])/l[0],d=o[1]/l[1];0===o[2]&&0===o[3]&&(m=d=1),c=new Float32Array([p,d,p,v,m,d,m,v])}t.sharedGeometry.setTextureUVs(c);var E=n.getColor(),y=new Float32Array([E.r,E.g,E.b,E.a,E.r,E.g,E.b,E.a,E.r,E.g,E.b,E.a,E.r,E.g,E.b,E.a]);t.sharedGeometry.setColors(y);var T=new Float32Array([-s[0],-s[1],0,-s[0],s[1],0,s[0],-s[1],0,s[0],s[1],0]);
t.sharedGeometry.setPositions(T),e.setGeometry(t.sharedGeometry),e.drawIndexedPrimitives(u.DrawingMode.TrianglesStrip,0,4)}}}},{key:"isDefaultProgramLoaded",value:function(){if(t.sharedProgram.isReady())return!0;var e="uniform mat4 uCamera;uniform mat4 uModel;attribute vec4 aPosition;attribute vec4 aColor;attribute vec2 aTexCoord;varying vec4 vColor;varying vec2 vUV;void main() {gl_Position = (uCamera * uModel) * aPosition;vColor      = aColor;vUV         = aTexCoord;}",n="uniform lowp sampler2D texture;varying lowp vec4 vColor;varying mediump vec2 vUV;void main() {gl_FragColor = texture2D(texture, vUV) * vColor;}";return t.sharedProgram.loadFromData(e,n),!1}}]),t}(l.RenderCommand);p.sharedGeometry=s.Geometry.createRectangle(.5,.5),p.sharedProgram=new c.Program},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0}),t.RenderCanvas=void 0;var u=n(41),s=n(40),c=n(43);t.RenderCanvas=function(e){function t(e){var n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];arguments.length<=2||void 0===arguments[2]?"webgl":arguments[2];r(this,t);var i=a(this,Object.getPrototypeOf(t).call(this));return i.renderApi=c.WebGL.getInstance(),i.context.init(u.Context.Type.WebGL,n,e),i}return i(t,e),o(t,[{key:"clear",value:function(e){this.removeTasks(),this.context.activate(),this.renderApi.clear(e)}}]),t}(s.RenderTarget)},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0}),t.Scene=void 0;var i=n(16);t.Scene=function(){function e(){r(this,e),this.root=new i.Node("root")}return a(e,[{key:"add",value:function(e){this.root.addChild(e)}},{key:"find",value:function(e){return this.root.findChild(e)}},{key:"remove",value:function(e){return this.root.removeChild(e)}},{key:"update",value:function t(e){function t(e,n,r){for(var a=e.update(n,r),i=e.getChildren(),o=0;o<i.length;o++)t(i[o],n,a||r)}t(this.root,e,!1)}},{key:"visit",value:function n(e){function n(e,t){e.visit(t);for(var r=e.getChildren(),a=0;a<r.length;a++)n(r[a],t)}n(this.root,e)}}]),e}()},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0}),t.Skybox=void 0;var u=n(27),s=n(55);t.Skybox=function(e){function t(){r(this,t);var e=a(this,Object.getPrototypeOf(t).call(this));return e.customProgram=null,e.texture=null,e}return i(t,e),o(t,[{key:"draw",value:function(e){this.texture&&e.getActiveTask().addCommand(new s.SkyboxCommand(this))}},{key:"setCustomProgram",value:function(e){this.customProgram=e}},{key:"setTexture",value:function(e){this.texture=e}},{key:"getCustomProgram",value:function(){return this.customProgram}},{key:"getTexture",value:function(){return this.texture}}]),t}(u.Drawable)},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0}),t.SkyboxCommand=void 0;var u=n(18),s=n(20),c=n(29),l=n(30),f=(n(47),n(25)),h=n(3),p=t.SkyboxCommand=function(e){function t(e){r(this,t);var n=a(this,Object.getPrototypeOf(t).call(this));return n.skybox=e,n}return i(t,e),o(t,[{key:"execute",value:function(e){var n=this.skybox.getTexture();if(n&&n.isReady()){var r=this.skybox.getCustomProgram();if(!r){if(!t.isDefaultProgramLoaded())return;r=t.sharedProgram}var a=e.setProgram(r);if(-1!=a){if(1==a){var i=function(e){var t=h.mat4.create();return t[15]=1,t[14]=0,t[13]=0,t[12]=0,t[11]=0,t[10]=e[8],t[9]=e[7],t[8]=e[6],t[7]=0,t[6]=e[5],t[5]=e[4],t[4]=e[3],t[3]=0,t[2]=e[2],t[1]=e[1],t[0]=e[0],t};e.setUniform(r,"projection",f.Type.Matrix,e.getActiveCamera().getProjectionMatrix());var o=e.getActiveCamera().getViewMatrix(),s=h.mat3.fromMat4([],o);e.setUniform(r,"view",f.Type.Matrix,i(s))}e.setUniform(r,"uModel",f.Type.Matrix,this.skybox.getTransformationMatrix()),e.setDepthState(!1,!1,u.DepthFunction.Less),e.bindTextureCube(0,n),e.setGeometry(t.sharedGeometry),e.drawIndexedPrimitives(u.DrawingMode.Triangles,0,t.sharedGeometry.getIndexCount())}}}}],[{key:"isDefaultProgramLoaded",value:function(){if(t.sharedProgram.isReady())return!0;var e="uniform mat4 projection;uniform mat4 view;uniform mat4 uModel;attribute vec4 aPosition;attribute vec4 aColor;varying vec4 vColor;varying vec4 vUV;void main() {gl_Position = projection * view * aPosition;vColor      = aColor;vUV         = aPosition;}",n="uniform lowp samplerCube skybox;varying lowp vec4 vColor;varying mediump vec4 vUV;void main() {gl_FragColor = textureCube(skybox, vUV.xyz) * vColor;}";return t.sharedProgram.loadFromData(e,n),!1}}]),t}(l.RenderCommand);p.sharedGeometry=s.Geometry.createCube(.5,.5,.5),p.sharedProgram=new c.Program},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0}),t.SpotLight=void 0;var u=n(15);t.SpotLight=function(e){function t(){r(this,t);var e=a(this,Object.getPrototypeOf(t).call(this));return e.constant=1,e.cutoff=12.5,e.direction=[],e.linear=.09,e.quadratic=.032,e}return i(t,e),o(t,[{key:"setDirection",value:function(e,t,n){this.direction=[e,t,n]}},{key:"setCutoff",value:function(e){this.cutoff=e}},{key:"setValues",value:function(e,t,n){this.constant=e,this.linear=t,this.quadratic=n}},{key:"getDirection",value:function(){return this.direction}},{key:"getValues",value:function(){return[this.constant,this.linear,this.quadratic]}}]),t}(u.Light)}])});
//# sourceMappingURL=Lemon.min.js.map